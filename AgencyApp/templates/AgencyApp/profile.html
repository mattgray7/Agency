{% extends "base.html" %}

{% block content %}

	<script>
		function redirect(destination){
			// Redirects to to destination
			var form = createPageRedirectForm("{{next}}", "{{next}}", destination, "{{currentPageURL}}", null, null);
			form.submit();
		}
		var activeInterest = "work";
		function getProfessionList(){
			var returnString = '';
			{% if profileInterests.work %}
				returnString += '<div class="profileProfessionList"><ul>';
				{% for interest in profileInterests.work %}
					returnString += '<li> {{interest.professionName}} </li>'
				{% endfor %}
				returnString += '</ul></div>';
			{% endif %}
			return returnString;
		}

		function getHiringList(){
			var returnString = '';
			{% if profileInterests.hire %}
				returnString += '<div class="profileProfessionList"><ul>'
				{% for interest in profileInterests.hire %}
					{% if interest.subInterest == "hireProject" %}
						returnString += "<li>Projects</li>";
					{% elif interest.subInterest == "hirePermanent" %}
						returnString += "<li>Permanent Positions</li>";
					{% elif interest.subInterest == "casting" %}
						returnString += "<li>Casting</li>";
					{% elif interest.subInterest == "collaborating" %}
						returnString += "<li>Collaborating</li>"
					{% endif %}
				{% endfor %}
				returnString += "</ul></div>";
			{% endif %}
			return returnString;
		}

		function toggleInterest(buttonElement, interestType){
			if(interestType != activeInterest){
				// Set this button to active
				var newActiveButtonId = interestType + "ToggleInterestButton";
				var newActiveButton = document.getElementById(newActiveButtonId);
				if(newActiveButton != null){
					newActiveButton.className = "blackButton";
				}
				var oldActiveButtonId = activeInterest + "ToggleInterestButton";
				var oldActiveButton = document.getElementById(oldActiveButtonId);
				if(oldActiveButton != null){
					oldActiveButton.className = "whiteButton";
				}
				activeInterest = interestType;
				document.getElementById("interestTitle").innerHTML = getInterestTitle(interestType)
				if(interestType === "work"){
					document.getElementById("interestContent").innerHTML = getProfessionList();
				}else if(interestType === "hire"){
					document.getElementById("interestContent").innerHTML = getHiringList();
				}
			}
		}

		function getInterestTitle(interestType){
			var headerTag = "<h2>";
			{% if profileUserAccount.workInterest and profileUserAccount.hireInterest %}
				headerTag = "<h2 style='padding: 10px 0px 1px 0px;'>";
			{% endif %}

			var interestTitle = "";
			if(interestType === "work"){
				interestTitle = headerTag + "Seeking Work</h2>"
			}else if(interestType === "hire"){
				interestTitle = headerTag + "Hiring</h2>"
			}else{
				interestTitle = "<h3>No interests selected</h3>";
			}
			return interestTitle
		}

		var profileTabs = ["background", "posts", "events", "reviews"];
		function selectProfileTab(tabType){
			for(var i=0; i < profileTabs.length; i++){
				var buttonId = profileTabs[i] + "ProfileButton";
				var borderCoverId = profileTabs[i] + "BorderCover";
				var profileButtonDiv = document.getElementById(buttonId);
				var profileButtonBorderCoverDiv = document.getElementById(borderCoverId)
				if(profileButtonDiv != null && profileButtonBorderCoverDiv != null){
					if(profileTabs[i] === tabType){
						profileButtonDiv.className = "profileTabButtonActive";
						profileButtonBorderCoverDiv.style.display = "block";
					}else{
						profileButtonDiv.className = "profileTabButtonInactive";
						profileButtonBorderCoverDiv.style.display = "none";
					}
				}


					
			}
		}
	</script>

	{% if profileUserAccount %}
		<div id="profilePageDiv">
			<table id="profilePageTable" class="profileTable">
				<tr>
					<td class="profileTableMainColumn">
						<table style="height:100%; width:100%; border-spacing:0.2em; margin: 0px -5px 0px 5px;">
							<tr>
								<td class="profilePanel profilePicturePanel">
									<div id="profilePictureBoundingBox" class="hoverContainer" style="width:250px; height:250px; background: #000; border: 2px solid #000; border-radius:6px; vertical-align: middle; display: table-cell;">
										{% if profileUserAccount.profilePicture %}
											<div id="profilePictureDiv">
												<img src="{{ profileUserAccount.profilePicture.url }}" style="width:250px;"/>
											</div>
										{% else %}
											<div id="profilePictureDiv">
												<img />
											</div>
										{% endif %}
										{% if viewingOwnProfile %}
											<div class="grayAlphaOverlay"></div>
	  										<div class="hoverButton"><a onclick="redirect('{{ possibleDestinations.picture }}');"> Edit </a></div>
	  									{% endif %}
									</div>
									<div id="profileBackgroundDiv" class="hoverContainer">
										<div id="profileBackgroundTextDiv" style="width: 245px; word-wrap: break-word; padding: 0em 0.3em 0em 0.3em;">
											<h1>{{ displayName }} </h1>
											{% if profileUserAccount.mainProfession %}
												<h3> {{profileUserAccount.mainProfession}} </h3>
											{% endif %}
											{% if profileUserAccount.bio %}
												<p class="profileBioText"> {{ profileUserAccount.bio }} </p>
											{% endif %}

											{% if viewingOwnProfile %}
												<!--<div class="grayOutlineOverlay"></div>-->
		  										<div class="hoverButton">
		  											<a onclick="redirect('{{ possibleDestinations.background }}');"> <font style="color:#000;">Edit </font></a>
		  										</div>
		  									{% endif %}
										</div>

										{% if profileLinks %}
											<div id="profileLinksDiv" style="height: 30px; padding: 0.5em 0em 0em 0em;">
												<table style="border-width:6px;">
													<tr>
														{% for link in profileLinks %}
															{% if link.url and link.label %}
																<td>
																	<div class="whiteButton blackHover" style="padding: 1px 4px 1px 4px; display:inline; z-index:2; position: relative;" onclick="window.location.href='{{link.url}}';">
																		{{ link.label }}
																	</div>
																</td>
															{% endif %}
														{% endfor %}
													</tr>
												</table>
											</div>
										{% endif %}
									</div>
								</td>
							</tr>
							<tr>
								<td class="profilePanel interestsPanel" style="width:259px">
									<div id="interestsPanel" class="hoverContainer">
										<table>
											{% if profileUserAccount.workInterest and profileUserAccount.hireInterest %}
												<tr>
													<td style="display: inline;">
														<div class="blackButton" id="workToggleInterestButton" onclick="toggleInterest(this, 'work');" style="padding: 1px 37px 1px 37px; display:inline; z-index:1; position: relative; border-radius: 1px;">
															Work
														</div>
														<div class="whiteButton" id="hireToggleInterestButton" onclick="toggleInterest(this, 'hire');" style="padding: 1px 37px 1px 37px; display:inline; z-index:1; position: relative; border-radius: 1px;">
															Hiring
														</div>
													</td>
												</tr>
											{% endif %}

											<!-- Move the hover edit button lower if work/hire button exists -->
											{% if profileUserAccount.workInterest and profileUserAccount.hireInterest %}
												<div class="hoverButton" style="z-index:2; top: 45px;">
											{% elif profileUserAccount.workInterest or profileUserAccount.hireInterest%}
												<div class="hoverButton" style="z-index:2; top: 9px;">
											{% else %}
												<div class="hoverButton" style="z-index:2; top: 5px;">
											{% endif %}
												<a onclick="redirect('{{ possibleDestinations.interests }}');"> <font style="color:#000;">Edit </font></a>
											</div>
											<tr>
												<td>
													<div id="interestTitle"></div>
												</td>
											</tr>
											<tr>
												<td>
													<div id="interestContent"></div>
												</td>
											</tr>
										</table>
									</div>
								</td>
							</tr>
						</table>
					</td>
					<td colspan="2" class="profileTableMainColumn" style="width:50%; max-width:50%: position:relative;">
						<table style="height:100%; position:absolute; top: 100px;">
							<tr>
								<td>
									<div class="profilePanel postsPanel" style="min-width: 400px; width:100%;">
										<table>
											<tr>
												<td style="text-align:center;">
													<div class="profileTabButtonActive" id="backgroundProfileButton" onclick="selectProfileTab('background')" style="margin-left: 0px;">
														Background
														<div id="backgroundBorderCover" class="profileTabBorderCover" style="display:block;"></div>
													</div>
													<div class="profileTabButtonInactive" id="postsProfileButton" onclick="selectProfileTab('posts')">
														Posts
														<div id="postsBorderCover" class="profileTabBorderCover"></div>
													</div>
													<div class="profileTabButtonInactive" id="eventsProfileButton" onclick="selectProfileTab('events')">
														Events
														<div id="eventsBorderCover" class="profileTabBorderCover"></div>
													</div>
													<div class="profileTabButtonInactive" id="reviewsProfileButton" onclick="selectProfileTab('reviews')">
														Reviews
														<div id="reviewsBorderCover" class="profileTabBorderCover"></div>
													</div>
												</td>
											</tr>
											<tr>
												<td>
													<div class="profileDisplayPanel">

													</div>
												</td>
											</tr>
										</table>
									</div>
								</td>
							</tr>
							<tr style="max-width: 400px;">
								<td >
									<div class="profilePanel commentsPanel" style="min-width: 400px; width:100%;">
										Comments and shit
									</div>
								</td>
							</tr>
						</table>
					</td>
					<td class="profileTableMainColumn" style="width:20%">
						<table style="height:100%;">
							<tr>
								<td>
									<div class="profilePanel rightPanel" style="min-width: 100px; width:100%;">
										other stuff
									</div>
								</td>
							</tr>
						</table>
					</td>
				</tr>
			</table>
			<script>
				// Have to do script outside of table, otherwise it affects formatting
				var interestDiv = document.getElementById("interestContent");
				var interestTitleDiv = document.getElementById("interestTitle")
				if(interestDiv != null && interestTitleDiv != null){
					var headerTag = "<h2>";
					{% if profileUserAccount.workInterest and profileUserAccount.hireInterest %}
						headerTag = "<h2 style='padding: 10px 0px 1px 0px;'>";
					{% endif %}

					{% if profileUserAccount.workInterest %}
						interestDiv.innerHTML = getProfessionList();
						interestTitleDiv.innerHTML = getInterestTitle("work")
					{% elif profileUserAccount.hireInterest %}
						interestDiv.innerHTML = getHiringList();
						interestTitleDiv.innerHTML = getInterestTitle("hire")
					{% else %}
						interestDiv.innerHTML = ""
						interestTitleDiv.innerHTML = getInterestTitle("other")
					{% endif %}
				}
			</script>
		</div>


		<!--{% if profileUserAccount.profilePicture %}
			<div id="profilePic">
				<img src="{{ profileUserAccount.profilePicture.url }}" height="150px" width="175px"/>
			</div>
		{% else %}
			<div id="profilePic">
				<img height="150px" width="175px"/>
			</div>
		{% endif %}
		{% if viewingOwnProfile %}
			<form action="{{ currentPageURL }}" method="post">
				{% csrf_token %}
				<input type="hidden" name="source" value="{{ next }}" />
				<input type="hidden" name="current" value="{{ next }}" />
				<input type="hidden" name="destination" value="{{ possibleDestinations.picture }}" />
				<input type="submit" value="Edit profile picture" />
			</form>
		{% endif %}
		<h1><u> {{ profileUserAccount.firstName }} {{ profileUserAccount.lastName }}</u></h1>

		{% if profileUserAccount.bio %}
			{{profileUserAccount.bio}}<br>
		{% endif %}

		{% if profileUserAccount.reelLink %}
			<a href="{{profileUserAccount.reelLink}}">Reel</a>
		{% endif %}
		{% if profileUserAccount.imdbLink %}
			<a href="{{profileUserAccount.imdbLink}}">IMDB</a>
		{% endif %}

		{% if viewingOwnProfile %}
			<form action="{{ currentPageURL }}" method="post">
				{% csrf_token %}
				<input type="hidden" name="source" value="{{ next }}" />
				<input type="hidden" name="current" value="{{ next }}" />
				<input type="hidden" name="destination" value="{{ possibleDestinations.background }}" />
				<input type="submit" value="Edit background" />
			</form>
		{% endif %}
		<br>

		<h3> Interests: </h3>
		<ul>
			{% if profileInterests.work %}
				<li>
					<script>
						function getTruncatedProfessionList(){
							var professionString = "";
							{% if profileInterests.work %}
								var addProfession = true;
								{% for interest in profileInterests.work %}
									if(professionString.length < 30){
										professionString += "{{ interest.professionName }}"
									}else{
										if(addProfession){
											professionString += " and " + ({{ profileInterests.work|length }} - {{ forloop.counter }} + 1) + " more jobs."
											addProfession = false;
										}
									}
									if(addProfession){
										professionString += ", ";
									}
								{% endfor %}
							{% endif %}
							return professionString
						}
						document.write("Seeking work as a " + getTruncatedProfessionList());
					</script>

				</li>
			{% endif %}
			{% if profileInterests.hire %}
				{% for interest in profileInterests.hire %}
					{% if interest.subInterest == "hireProject" %}
						<li>Hiring for a project</li>
					{% endif %}
					{% if interest.subInterest == "hirePermanent" %}
						<li>Hiring for a permanent position</li>
					{% endif %}
					{% if interest.subInterest == "casting" %}
						<li>Casting roles for a project</li>
					{% endif %}
					{% if interest.subInterest == "collaborating" %}
						<li>Looking for collaborators</li>
					{% endif %}
				{% endfor %}
			{% endif %}
			{% if profileInterests.other %}
				<li>No interests registered.</li>
			{% endif %}
			{% if profileUserAccount.actingInterest %}
				<li>
					Acting and extra work
					{% if viewingOwnProfile %}
						<form style="display:inline" action="{{ currentPageURL }}" method="post">
							{% csrf_token %}
							<input type="hidden" name="source" value="{{ next }}" />
							<input type="hidden" name="current" value="{{ next }}" />
							<input type="hidden" name="destination" value="{{ possibleDestinations.actorDescription }}" /> 
							{% if profileUserAccount.actorDescriptionEnabled %}
								<input type="submit" value="Edit actor description" />
							{% else %}
								<input type="submit" value="Enable actor descriptions" />
							{% endif %}
						</form>
					{% endif %}
				</li>
			{% endif %}
		</ul>
		{% if viewingOwnProfile %}
			<form action="{{ currentPageURL }}" method="post">
				{% csrf_token %}
				<input type="hidden" name="source" value="{{ next }}" />
				<input type="hidden" name="current" value="{{ next }}" />
				<input type="hidden" name="destination" value="{{ possibleDestinations.interests }}" />
				<input type="submit" value="Edit profile interests" />
			</form>
		{% endif %}
		<br>

		{% if profileProfessions %}
			<h3> {{ profileUserAccount.firstName }}'s interested professions include...</h3>
			<ul>
				{% for profession in profileProfessions %}
					<li>{{ profession }}</li>
				{% endfor %}
			</ul>
		{% else %}
			<h3> {{ profileUserAccount.firstName }} has not specified his interested professions </h3>
		{% endif %}
		{% if viewingOwnProfile %}
			<form action="{{ currentPageURL }}" method="post">
				{% csrf_token %}
				<input type="hidden" name="source" value="{{ next }}" />
				<input type="hidden" name="current" value="{{ next }}" />
				<input type="hidden" name="destination" value="{{ possibleDestinations.professions }}" />
				<input type="submit" value="Edit professions" />
			</form>
		{% endif %}

		{% if profileEvents %}
			<br><h3>Events {{ profileUserAccount.firstName }} has posted...</h3>
				{% for event in profileEvents %}
					<form method="post" action="{{ currentPageURL }}"> 
						{% csrf_token %}
						<input type="hidden" name="eventID" value="{{event.eventID}}" />
						<input type="hidden" name="source" value="{{ next }}" />
						<input type="hidden" name="next" value="{{ next }}" />
						<input type="hidden" name="destination" value="{{ possibleDestinations.viewEvent }}" />
						<input type="submit" Value="{{ event.title }}" />
					</form>
				{% endfor %}
		{% endif %}

		{% if profilePosts %}
			{% if profilePosts.events %}
		    	<br>
		    	<h3>Events {{ profileUserAccount.firstName }} has posted...</h3>
				{% for event in profilePosts.events %}
					<form method="post" action="{{ currentPageURL }}"> 
						{% csrf_token %}
						<input type="hidden" name="postID" value="{{event.postID}}" />
						<input type="hidden" name="source" value="{{ next }}" />
						<input type="hidden" name="next" value="{{ next }}" />
						<input type="hidden" name="destination" value="{{ possibleDestinations.viewPost }}" />
						<input type="submit" Value="{{ event.title }}" />
					</form>
				{% endfor %}
			{% endif %}
			{% if profilePosts.projects %}
				<br>
				<h3>Projects {{ userAccount.firstName }} is involved in...</h3>
				{% for projectPost in profilePosts.projects %}
					<form method="post" action="{{ currentPageURL }}"> 
						{% csrf_token %}
						<input type="hidden" name="postID" value="{{projectPost.postID}}" />
						<input type="hidden" name="source" value="{{ next }}" />
						<input type="hidden" name="next" value="{{ next }}" />
						<input type="hidden" name="destination" value="{{ possibleDestinations.viewPost }}" />
						<input type="submit" Value="{{ projectPost.title }}" />
					</form>
				{% endfor %}
			{% endif %}
			{% if profilePosts.collaboration %}
				<br>
				<h3>Seeking collaborators posts...</h3>
				{% for collabPost in profilePosts.collaboration %}
					<form method="post" action="{{ currentPageURL }}"> 
						{% csrf_token %}
						<input type="hidden" name="postID" value="{{collabPost.postID}}" />
						<input type="hidden" name="source" value="{{ next }}" />
						<input type="hidden" name="next" value="{{ next }}" />
						<input type="hidden" name="destination" value="{{ possibleDestinations.viewPost }}" />
						<input type="submit" Value="{{ collabPost.title }}" />
					</form>
				{% endfor %}
			{% endif %}
			{% if profilePosts.work %}
				<br>
				<h3>Seeking crew posts...</h3>
				{% for workPost in profilePosts.work %}
					<form method="post" action="{{ currentPageURL }}"> 
						{% csrf_token %}
						<input type="hidden" name="postID" value="{{workPost.postID}}" />
						<input type="hidden" name="source" value="{{ next }}" />
						<input type="hidden" name="next" value="{{ next }}" />
						<input type="hidden" name="destination" value="{{ possibleDestinations.viewPost }}" />
						<input type="submit" Value="{{ workPost.title }}" />
					</form>
				{% endfor %}	
			{% endif %}
			{% if profilePosts.casting %}
				<br>
				<h3>Seeking actor posts...</h3>
				{% for castingPost in profilePosts.casting %}
					<form method="post" action="{{ currentPageURL }}">
						{% csrf_token %}
						<input type="hidden" name="postID" value="{{castingPost.postID}}" />
						<input type="hidden" name="source" value="{{ next }}" />
						<input type="hidden" name="next" value="{{ next }}" />
						<input type="hidden" name="destination" value="{{ possibleDestinations.viewPost }}" />
						<input type="submit" Value="{{ castingPost.title }}" />
					</form>
				{% endfor %}
			{% endif %}
		{% endif %}	
	-->
	{% else %}
		No user with name {{ profileUsername }} found.
	{% endif %}

{% endblock %}
