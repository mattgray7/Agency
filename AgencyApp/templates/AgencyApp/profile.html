{% extends "base.html" %}

{% block content %}
{% load static %}
<link href="{% static "/AgencyApp/css/profile.css" %}" rel="stylesheet" type="text/css" media="all" />
<script type="text/javascript" src="{% static "/AgencyApp/js/post/post.js" %}"></script>
<script type="text/javascript" src="{% static "/AgencyApp/js/profile.js" %}"></script>
<script>
    var activeInterest = "work";
    var profileTabs = ["bio", "filmography", "media", "endorsements"];
    var profileTabDisplayFunctions = {"bio": displayBio, "filmography": displayFilmography, "media": displayMedia,"endorsements": displayEndorsements};

    function selectProfileTab(tabType){
        for(var i=0; i < profileTabs.length; i++){
            var buttonId = profileTabs[i] + "ProfileButton";
            var borderCoverId = profileTabs[i] + "BorderCover";
            var profileButtonDiv = document.getElementById(buttonId);
            var profileButtonBorderCoverDiv = document.getElementById(borderCoverId)
            if(profileButtonDiv != null && profileButtonBorderCoverDiv != null){
                if(profileTabs[i] === tabType){
                    profileButtonBorderCoverDiv.style.opacity = "1";
                    profileButtonDiv.className = "active";
                }else{
                    profileButtonBorderCoverDiv.style.opacity = "0";
                    profileButtonDiv.className = "";
                }
            }
        }
        if(tabType in profileTabDisplayFunctions){
            profileTabDisplayFunctions[tabType]()
        }

        // Update main view panel height after tab content is changed
        var projectContentPanel = document.getElementById("profileContentPanel")
        if(projectContentPanel != null){
            var tabButtonsHeight = document.getElementById("profileTabButtonList").offsetHeight;
            var projectContentHeight = document.getElementById("profileTabContentPanelContainer").offsetHeight;
            projectContentPanel.style.height = tabButtonsHeight + projectContentHeight + "px";
        }
    }

    function displayBio(){
        var tabContent = document.getElementById("profileTabContentPanel");
        if(tabContent != null){
            var bioData = [{"label": "Name", "value": "{{profileUserAccount.cleanName}}"},
                           {"label": "Professions", value: getProfessionList()},
                           {"label": "Email", "value": "{{profileUserAccount.email}}"},
                           {"label": "Phone #", "value": "{{profileUserAccount.phoneNumber}}"},
                           {"label": "Location", "value": "{{profileUserAccount.location}}"},
                           {"label": "Date of Birth", "value": "{{profileUserAccount.dateOfBirth}}"},
                           {"label": "Education", "value": "{{profileUserAccount.education}}"},
                           {"label": "Bio", "value": "{{profileUserAccount.bio}}"}
                           ]

            // Have to add links separately because need to check if they exist before adding
            {% if profileUserAccount.resume or profileUserAccount.imdbLink %}
                var linksDict = {"label": "Links", "value": []};
                {% if profileUserAccount.imdbLink %}
                    linksDict["value"].push({"label": "IMDB", "href": "{{profileUserAccount.imdbLink}}"})
                {% endif %}
                {% if profileUserAccount.resume %}
                    linksDict["value"].push({"label": "Resume", "href": "/media/{{profileUserAccount.resume}}"})
                {% endif %}
                bioData.push(linksDict)
            {% endif %}


            // Start with edit button
            var contentString = "<div style='position: absolute; top: -3px; right: 15px;'><div class='hoverButton'><a onclick='redirect(" + '"{{ possibleDestinations.background }}");' + "'>Edit</a></div></div>";

            contentString += "<div style='text-align: left; margin-left: 10px; margin-top: 10px;'><ul style='line-height: 26px;'>";

            for (record in bioData){
                if(bioData[record]["value"].length > 0 && bioData[record]["value"] != "None"){
                    contentString += "<li>" + bioData[record]["label"] + ": "

                    // Check if value is a list
                    if(Object.prototype.toString.call(bioData[record]["value"]) === '[object Array]'){
                        for(var i=0; i < bioData[record]["value"].length; i++){
                            if(bioData[record]["value"][i]["href"] != '')
                            contentString += " <a href='" + bioData[record]["value"][i]["href"] + "'>" + bioData[record]["value"][i]["label"] + "</a> |"
                        }
                        // Remove last '|' character
                        contentString = contentString.slice(0, -2)
                    }else{
                        contentString += bioData[record]["value"];
                    }
                    contentString += "</li>"
                }
            }

            contentString += "<ul></div>";

            // Add edit button
            tabContent.innerHTML = contentString;
        }
    }

    function displayFilmography(){
        var tabContent = document.getElementById("profileTabContentPanel")
        if(tabContent != null){
            {% if filmography %}
                var filmography = {{filmography|safe}}
                tabContent.innerHTML = "<div style='width: 80%; margin: 10px auto;'>" + createProjectFeed(filmography) + "</div>"
            {% endif %}
        }
    }

    function displayMedia(){
        console.log("media")
    }

    function displayEndorsements(){
        console.log("endorsements")
    }

    function getProfessionList(){
        // TODO use 'mainProfessionList' or whatever its called instead of interested work professions
        var returnString = '';
        {% if profileInterests.work %}
            returnString += '<div class="profileProfessionList"><ul>';
            {% for interest in profileInterests.work %}
                returnString += '<li>| {{interest.professionName}} | </li>'
            {% endfor %}
            returnString += '</ul></div>';
        {% endif %}
        return returnString;
    }
</script>

    <script>
        function getHiringList(){
            var returnString = '';
            {% if profileInterests.hire %}
                returnString += '<div class="profileProfessionList"><ul>'
                {% for interest in profileInterests.hire %}
                    {% if interest.subInterest == "hireProject" %}
                        returnString += "<li>Projects</li>";
                    {% elif interest.subInterest == "hirePermanent" %}
                        returnString += "<li>Permanent Positions</li>";
                    {% elif interest.subInterest == "casting" %}
                        returnString += "<li>Casting</li>";
                    {% elif interest.subInterest == "collaborating" %}
                        returnString += "<li>Collaborating</li>"
                    {% endif %}
                {% endfor %}
                returnString += "</ul></div>";
            {% endif %}
            return returnString;
        }

        function toggleInterest(buttonElement, interestType){
            if(interestType != activeInterest){
                // Set this button to active
                var newActiveButtonId = interestType + "ToggleInterestButton";
                var newActiveButton = document.getElementById(newActiveButtonId);
                if(newActiveButton != null){
                    newActiveButton.className = "blackButton";
                }
                var oldActiveButtonId = activeInterest + "ToggleInterestButton";
                var oldActiveButton = document.getElementById(oldActiveButtonId);
                if(oldActiveButton != null){
                    oldActiveButton.className = "whiteButton";
                }
                activeInterest = interestType;
                document.getElementById("interestTitle").innerHTML = getInterestTitle(interestType)
                if(interestType === "work"){
                    document.getElementById("interestContent").innerHTML = getProfessionList();
                }else if(interestType === "hire"){
                    document.getElementById("interestContent").innerHTML = getHiringList();
                }
            }
        }

        function getInterestTitle(interestType){
            var headerTag = "<h2>";
            {% if profileUserAccount.workInterest and profileUserAccount.hireInterest %}
                headerTag = "<h2 style='padding: 10px 0px 1px 0px;'>";
            {% endif %}

            var interestTitle = "";
            if(interestType === "work"){
                interestTitle = headerTag + "Seeking Work</h2>"
            }else if(interestType === "hire"){
                interestTitle = headerTag + "Hiring</h2>"
            }else{
                interestTitle = "<h3>No interests selected</h3>";
            }
            return interestTitle
        }


        function createProjectListElement(projectID, projectPictureURL, title, status, involvementString){
            var projectString = "<li id='profileProjectListElement_" + projectID + "' class='profileProjectListElement' onclick='redirectToPost(" + '"' + projectID + '");' + "'>"
            projectString += "<div class='profileProjectListElementImageContainer'>" + getPictureTag(projectPictureURL, "profileProjectListElementImage", "") + "</div>";
            projectString += "<div class='profileProjectListElementText'><h3>" + title + "</h3><h5>" + status + "<br>" + involvementString + "<br>"

            /*if(numOpenRoles > 0){
                projectString += parseInt(numOpenRoles) + " ";
                if(numOpenRoles === 1){
                    projectString += "role";
                }else{
                    projectString += "roles";
                }
                projectString += " available<br>"
            }else{
                projectString += "<br>";
            }
            if(numOpenJobs > 0){
                projectString += "Hiring for " + parseInt(numOpenJobs) + " ";
                if(numOpenJobs === 1){
                    projectString += "position";
                }else{
                    projectString += "positions";
                }
            }else{
                projectString += "<br>";
            }*/
            projectString += "</h5></div></li>";
            return projectString
        }

        function getInvolvementString(projectID, rolesString, jobsString, creator){
            var jobs = JSON.parse(jobsString.replace(/&quot;/g, '"'));
            var roles = JSON.parse(rolesString.replace(/&quot;/g, '"'));
            var returnString = "";
            var padCount = 0;
            if(creator === "True"){
                returnString += "Creator<br>";
                padCount -= 1;
            }else{
                padCount += 1;
            }
            if(roles.length > 0){
                if(roles.length === 1){
                    returnString += "Actor (<a onclick='redirectToPost(" + '"' + roles[0]["postID"] + '");' + "'>" + roles[0]["characterName"] + "</a>)<br>"
                }else{
                    returnString += "Actor (<a onclick='redirectToPost(" + '"' + projectID + '");' + "'>" + roles.length + " roles</a>)<br>"
                }
            }else{
                padCount += 1;
            }
            if(jobs.length > 0){
                returnString += "Worked as ";
                for(var i=0; i < jobs.length; i++){
                    returnString += "<a onclick='redirectToPost(" + '"' + jobs[i]["postID"] + '");' + "'>" +  jobs[i]["profession"] + "</a>";
                    if(i != jobs.length-1){
                        returnString += ", ";
                    }
                }
            }else{
                padCount += 1
            }
            if(padCount > 0){
                for(var i=0; i < padCount-1; i++){
                    returnString += "<br>";
                }
            }
            return returnString
        }

        function createProjectsList(status){
            var displayString = "";
            {% if profilePosts.projects %}
                displayString += "<div id='" + status + "ProjectPanel' class='projectListPanel'><ul class='profileProjectList'><li><h2>"
                if(status === "current"){
                    displayString += "Current Projects";
                }else{
                    displayString += "Past Projects";
                }
                displayString += "</h2></li>";
                {% for projectPost in profilePosts.projects %}
                    
                    if("{{projectPost.status}}" === status){
                        var picURL = null
                        {% if projectPost.project.postPicture %}
                            picURL = "{{ projectPost.project.postPicture.url }}"
                        {% endif %}

                        var involvementString = getInvolvementString("{{projectPost.project.postID}}", "{{projectPost.roles}}", "{{projectPost.jobs}}", "{{projectPost.creator}}")
                        displayString += createProjectListElement("{{projectPost.project.postID}}", picURL, "{{projectPost.project.title}}", "{{projectPost.project.status}}", involvementString)
                    }
                {% endfor %}
                displayString += "</ul></div>";
            {% endif %}
            return displayString;
        }

        function displayBackground(){
            var profileDisplayPanelDiv = document.getElementById("profileDisplayPanel")
            if(profileDisplayPanelDiv != null){
                var backgroundString = "";
                {% if hasCurrentProjects %}
                    backgroundString += createProjectsList("current")
                {% endif %}
                {% if hasPastProjects %}
                    backgroundString += createProjectsList("past")
                {% endif %}
                if(backgroundString === ""){
                    backgroundString = "{{profileUserAccount.firstName}} has not registered any projects."
                }
                profileDisplayPanelDiv.innerHTML = backgroundString;
            }
        }
    </script>

<div id='backgroundPanel' class='backgroundPanel' style='min-width: 634px; min-height: 100%;'>
    <div id="mainViewPanel" class="mainViewPanel" style="position: relative; min-width: 620px; max-width: 675px; background: rgba(0,0,0,0.05); border: none;">
        {% if profileUserAccount %}
            <div style='min-height: 350px; width: 100%;'>
                <div id='profileHeaderPanel' class='profileHeaderPanel' style='position: absolute; right: 10px; left: 10px; margin: 0 auto;'>
                    <div style='position: relative; width: 100%; height: 100%;'>
                        <div style='position: absolute; left: 15px; top: 15px;'>
                            {% if profileUserAccount.profilePicture %}
                                <img class="profilePicture" src="{{ profileUserAccount.profilePicture.url }}" />
                            {% else %}
                                <img class="profilePicture" src="{{ images.noProfilePicture }}"/>
                            {% endif %}
                        </div>
                        <div style='position: absolute; left: 15px; top: 275px; text-align: left;'>
                            <h1><a onclick='redirectToUser("{{profileUserAccount.username}}");' >{{profileUserAccount.cleanName}}</a></h1>
                            <script>document.write(getProfessionList())</script>
                        </div>
                    </div>
                </div>
            </div>
            <div id='profileContentPanel' style='position: relative; width: 100%; min-height: 100px; margin-top: 10px;'>
                <ul class='profileTabButtonList' id='profileTabButtonList' style='position: absolute; left: -2px; right: 0px; '>
                    <script>
                        for(var i=0; i < profileTabs.length; i++){
                            var tabButton = '<li style="width: 24%;" id="' + profileTabs[i] + 'ProfileButton" onclick="selectProfileTab(' + "'" + profileTabs[i] + "');" + '" style="margin-left: -3px;"><div style="margin-top: 5px;">' + profileTabs[i] + '</div><div id="' + profileTabs[i] + 'BorderCover" class="profileTabButtonBorderCover"></div></li>';
                            document.write(tabButton);
                        }
                    </script>
                </ul>
                <div id='profileTabContentPanelContainer' style='position: absolute; border: 1px solid #000; top: 50px; left: 2px; right: 4px; margin-top: -7px; background: #FFF; z-index: 0; min-height: 50px;'>
                    <div id='profileTabContentPanel' style='position: relative;'>

                    </div>
                </div>
            </div>
        {% else %}
            No user Found
        {% endif %}
    </div>
</div>

<script>
selectProfileTab("bio")
</script>



<!--
    {% if profileUserAccount %}
        <div id="profilePageDiv">
            <table id="profilePageTable" class="profileTable">
                <tr>
                    <td class="profileTableMainColumn">
                        <table style="height:100%; width:100%; border-spacing:0.2em; margin: 0px -5px 0px 5px;">
                            <tr>
                                <td class="profilePanel profilePicturePanel">
                                    <div id="profilePictureBoundingBox" class="hoverContainer" style="width:250px; height:278px; background: #000; border: 2px solid #000; border-radius:6px;">
                                        {% if profileUserAccount.profilePicture %}
                                            <div id="profilePictureDiv">
                                                <img src="{{ profileUserAccount.profilePicture.url }}" style="width:250px;"/>
                                            </div>
                                        {% else %}
                                            <div id="profilePictureDiv">
                                                <img src="{{ images.noProfilePicture }}" style="width:250px;"/>
                                            </div>
                                        {% endif %}
                                        {% if viewingOwnProfile %}
                                            <div class="grayAlphaOverlay"></div>
                                            <div class="whiteHoverButton"><a onclick="redirect('{{ possibleDestinations.picture }}');"> Edit </a></div>
                                        {% endif %}
                                    </div>
                                    <div id="profileBackgroundDiv" class="hoverContainer">
                                        <div id="profileBackgroundTextDiv" style="width: 245px; word-wrap: break-word; padding: 0em 0.3em 0em 0.3em;">
                                            <h1>{{ displayName }} </h1>
                                            {% if profileUserAccount.mainProfession %}
                                                <h3> {{profileUserAccount.mainProfession}} </h3>
                                            {% endif %}
                                            {% if profileUserAccount.bio %}
                                                <p class="profileBioText"> {{ profileUserAccount.bio }} </p>
                                            {% endif %}

                                            {% if viewingOwnProfile %}
                                                <div class="hoverButton">
                                                    <a onclick="redirect('{{ possibleDestinations.background }}');">Edit</a>
                                                </div>
                                            {% endif %}
                                        </div>

                                        {% if profileLinks %}
                                            <div id="profileLinksDiv" style="height: 30px; padding: 0.5em 0em 0em 0em;">
                                                <table style="border-width:6px;">
                                                    <tr>
                                                        {% for link in profileLinks %}
                                                            {% if link.url and link.label %}
                                                                <td>
                                                                    <div class="whiteButton blackHover" style="padding: 1px 4px 1px 4px; display:inline; z-index:2; position: relative;" onclick="window.location.href='{{link.url}}';">
                                                                        {{ link.label }}
                                                                    </div>
                                                                </td>
                                                            {% endif %}
                                                        {% endfor %}
                                                    </tr>
                                                </table>
                                            </div>
                                        {% endif %}
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td class="profilePanel interestsPanel" style="width:259px">
                                    <div id="interestsPanel" class="hoverContainer">
                                        <table>
                                            {% if profileUserAccount.workInterest and profileUserAccount.hireInterest %}
                                                <tr>
                                                    <td style="display: inline;">
                                                        <div class="blackButton" id="workToggleInterestButton" onclick="toggleInterest(this, 'work');" style="padding: 1px 37px 1px 37px; display:inline; z-index:1; position: relative; border-radius: 1px;">
                                                            Work
                                                        </div>
                                                        <div class="whiteButton" id="hireToggleInterestButton" onclick="toggleInterest(this, 'hire');" style="padding: 1px 37px 1px 37px; display:inline; z-index:1; position: relative; border-radius: 1px;">
                                                            Hiring
                                                        </div>
                                                    </td>
                                                </tr>
                                            {% endif %}

                                            {% if viewingOwnProfile %}
                                                {% if profileUserAccount.workInterest and profileUserAccount.hireInterest %}
                                                    <div class="hoverButton" style="z-index:2; top: 45px;">
                                                {% elif profileUserAccount.workInterest or profileUserAccount.hireInterest%}
                                                    <div class="hoverButton" style="z-index:2; top: 9px;">
                                                {% else %}
                                                    <div class="hoverButton" style="z-index:2; top: 5px;">
                                                {% endif %}
                                                    <a onclick="redirect('{{ possibleDestinations.interests }}');">Edit</a>
                                                </div>
                                            {% endif %}
                                            <tr>
                                                <td>
                                                    <div id="interestTitle"></div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <div id="interestContent"></div>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </td>
                    <td colspan="2" class="profileTableMainColumn" style="width:50%; max-width:50%: position:relative;">
                        <table style="height:100%; position:absolute; top: 100px;">
                            <tr style="height: 100%; margin: 0px;">
                                <td>
                                    <div class="profilePanel postsPanel" style="min-width: 500px; width:100%; height: 100%; margin-top: -11px; margin-left: -12px; background:none; border:none;">
                                        <table>
                                            <tr>
                                                <td style="text-align:center; min-width: 515px;">
                                                    <div class="profileTabButtonInactive" id="backgroundProfileButton" onclick="selectProfileTab('background')" style="margin-left: -3px;">
                                                        Background
                                                        <div id="backgroundBorderCover" class="profileTabBorderCover"></div>
                                                    </div>
                                                    <div class="profileTabButtonInactive" id="postsProfileButton" onclick="selectProfileTab('posts')" style="margin-left:2px;">
                                                        Posts
                                                        <div id="postsBorderCover" class="profileTabBorderCover"></div>
                                                    </div>
                                                    <div class="profileTabButtonInactive" id="eventsProfileButton" onclick="selectProfileTab('events')" style="margin-right: 1px">
                                                        Events
                                                        <div id="eventsBorderCover" class="profileTabBorderCover"></div>
                                                    </div>
                                                    <div class="profileTabButtonInactive" id="reviewsProfileButton" onclick="selectProfileTab('reviews')" style="margin-right: -3px;">
                                                        Reviews
                                                        <div id="reviewsBorderCover" class="profileTabBorderCover" style="width: 132%;"></div>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <div id="profileDisplayPanel" class="profileDisplayPanel"></div>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                </td>
                            </tr>
                            
                        </table>
                    </td>
                    <td class="profileTableMainColumn" style="width:20%">
                        
                    </td>
                </tr>
            </table>
            <script>
                // Have to do script outside of table, otherwise it affects formatting
                var interestDiv = document.getElementById("interestContent");
                var interestTitleDiv = document.getElementById("interestTitle")
                if(interestDiv != null && interestTitleDiv != null){
                    var headerTag = "<h2>";
                    {% if profileUserAccount.workInterest and profileUserAccount.hireInterest %}
                        headerTag = "<h2 style='padding: 10px 0px 1px 0px;'>";
                    {% endif %}

                    {% if profileUserAccount.workInterest %}
                        interestDiv.innerHTML = getProfessionList();
                        interestTitleDiv.innerHTML = getInterestTitle("work")
                    {% elif profileUserAccount.hireInterest %}
                        interestDiv.innerHTML = getHiringList();
                        interestTitleDiv.innerHTML = getInterestTitle("hire")
                    {% else %}
                        interestDiv.innerHTML = ""
                        interestTitleDiv.innerHTML = getInterestTitle("other")
                    {% endif %}
                }

                selectProfileTab("background");
                //selectProfileTab("posts")
            </script>
        </div>

    {% else %}
        No user with name {{ profileUsername }} found.
    {% endif %}
    -->

{% endblock %}
