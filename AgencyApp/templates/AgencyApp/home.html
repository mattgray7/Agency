{% extends "base.html" %}

{% block content %}
<script>var userLoggedIn = false;</script>

{% if request.user.is_authenticated %}
	<script>userLoggedIn = true;</script>
	{% if status %}
		{% if status == "login_success" %}
			<h1> Welcome back {{ request.user.first_name }}</h1>
		{% elif status == "create_success" %}
			<h1> Your account was created successfully!</h1>
		{% else %}
			<h1>Here is your Agency feed:</h1>
		{% endif %}
	{% else %}
		<h1>Here is your Agency feed:</h1>
	{% endif %}
{% else %}
	{% csrf_token %}
	<h1>Welcome to The Agency! Let's get started, what are you looking for?</h1>
	<div id="buttonChoice"></div>
{% endif %}


<!--<script>
function getWelcomeMsg(){ 
	console.log("getting welcome msg")
	$.ajax({
		url : "/ajax/getWelcomeMsg/",
		data : {"foo": "bar"},
		type : 'POST',
		dataType: "json",
		success : function(data) {
			console.log(data.response);
		}
	});
}
</script>-->

<script>

var firstChoice = "<button onclick='eventsChosen();' value='Events'>Events (View and create events in your community)</button><br><br><button onclick='jobsChosen();' value='Jobs'>Jobs (Find a job, crew members, or others looking to collaborate)</button><br>";

var eventChoice = "<button onclick='viewEvents();'> View events in your community</button><br><br><button onclick='createEventPost();'>Create event</button><br><br><button onclick='displayFirstChoice();'>Back</button>";

var jobChoice = "<button onclick='viewPosts();'> View job postings and creative profiles</button><br><br><button onclick='createWorkPost();'>Create job post</button><br><br><button onclick='displayFirstChoice();'>Back</button>";

window.onload = displayFirstChoice();

function displayFirstChoice(){
	if(!userLoggedIn){
		document.getElementById('buttonChoice').innerHTML = firstChoice;
	};
}

function eventsChosen(){
	document.getElementById('buttonChoice').innerHTML = eventChoice;
}

function jobsChosen(){
	document.getElementById('buttonChoice').innerHTML = jobChoice;
}

function viewEvents(){
	window.location = '/browse';
}

function createEventPost(){
	var form = createLoginForm("{{ sources.event }}");
	form.submit()
}

function viewPosts(){
	window.location = '/browse';
}

function createWorkPost(){
	var form = createLoginForm("{{ sources.post }}");
	form.submit()
}

function createLoginForm(sourceString){
	var form = document.createElement("form");
	form.setAttribute('method',"post");
	form.setAttribute('action',"/login/");

	var source = document.createElement("input");
	source.setAttribute("type", "hidden");
	source.setAttribute("name", "source");
	source.setAttribute("value", sourceString)
	form.appendChild(source)

	var csrf = document.createElement("input");
	csrf.setAttribute("type", "hidden");
	csrf.setAttribute("name", "csrfmiddlewaretoken");
	csrf.setAttribute("value", getCookie('csrftoken'))
	form.appendChild(csrf);
	document.body.appendChild(form);
	return form;
}

</script>
{% endblock %}