{% extends "base.html" %}

{% block content %}
<script>var userLoggedIn = false;</script>

{% if request.user.is_authenticated %}
	<script>userLoggedIn = true;</script>
	{% if source == possibleSources.login %}
		<h3> Welcome back {{ request.user.first_name }}!</h3>
	{% endif %}
	<h1>What to do you want to do?</h1>
{% else %}
	<h1>Welcome to The Agency! Let's get started, what are you looking for?</h1>
{% endif %}
<div id="mainChoice"></div>


<!--<script>
function getWelcomeMsg(){ 
	console.log("getting welcome msg")
	$.ajax({
		url : "/ajax/getWelcomeMsg/",
		data : {"foo": "bar"},
		type : 'POST',
		dataType: "json",
		success : function(data) {
			console.log(data.response);
		}
	});
}
</script>-->

<script>

var mainChoice = "<button onclick='eventsChosen();' value='Events'>Events (View and create events in your community)</button><br><br><button onclick='jobsChosen();' value='Jobs'>Jobs (Find a job, crew members, or others looking to collaborate)</button><br>";

var createAccountButton = "<br><button onclick='createAccount()'; value='Create account'>Create account</button>";

var eventChoice = "<button onclick='viewEvents();'> View events in your community</button><br><br><button onclick='createEventPost();'>Create event</button><br><br><button onclick='displayMainChoice();'>Back</button>";

var jobChoice = "<button onclick='viewPosts();'> View job postings and creative profiles</button><br><br><button onclick='createWorkPost();'>Create job post</button><br><br><button onclick='displayMainChoice();'>Back</button>";

window.onload = displayMainChoice();

function displayMainChoice(){
	if (userLoggedIn){
		var toDisplay = mainChoice;
	}else{
		var toDisplay = mainChoice + createAccountButton;
	}
	document.getElementById('mainChoice').innerHTML = toDisplay;
}

function eventsChosen(){
	document.getElementById('mainChoice').innerHTML = eventChoice;
}

function jobsChosen(){
	document.getElementById('mainChoice').innerHTML = jobChoice;
}

function viewEvents(){
	window.location = '/browse/events/';
}

function viewPosts(){
	window.location = '/browse/posts/';
}

function createAccount(){
	var form = createForm("{{ possibleDestinations.createAccount }}", "{{ default }}", "/account/create/basic/");
	console.log(form);
	form.submit();
}

function createEventPost(){
	if(!userLoggedIn){
		var form = createForm("{{ possibleDestinations.login }}", "{{ possibleDestinations.event }}", "/login/");
	}else{
		var form = createForm("{{ possibleDestinations.event }}", "{{ default }}", "/create/event/")
	}
	form.submit()
}

function createWorkPost(){
	if(!userLoggedIn){
		var form = createForm("{{ possibleDestinations.login }}", "{{ possibleDestinations.post }}", "/login/");
	}else{
		var form = createForm("{{ possibleDestinations.post }}", "{{ default }}", "/create/post/choose/")
	}
	form.submit()
}

function createForm(nextInputValue, destinationInputValue, destinationURL){
	var form = document.createElement("form");
	form.setAttribute('method', "post");
	form.setAttribute('action', destinationURL);

	var sourceInput = document.createElement("input");
	sourceInput.setAttribute("type", "hidden");
	sourceInput.setAttribute("name", "source");
	sourceInput.setAttribute("value", "{{ source }}");
	form.appendChild(sourceInput);

	// called current, but is actually the next page to direct to 
	var nextInput = document.createElement("input");
	nextInput.setAttribute("type", "hidden");
	nextInput.setAttribute("name", "next");
	nextInput.setAttribute("value", nextInputValue)
	form.appendChild(nextInput)

	var destinationInput = document.createElement("input");
	destinationInput.setAttribute("type", "hidden");
	destinationInput.setAttribute("name", "destination");
	destinationInput.setAttribute("value", destinationInputValue);
	form.appendChild(destinationInput)

	var csrfInput = document.createElement("input");
	csrfInput.setAttribute("type", "hidden");
	csrfInput.setAttribute("name", "csrfmiddlewaretoken");
	csrfInput.setAttribute("value", getCookie('csrftoken'));
	form.appendChild(csrfInput);
	document.body.appendChild(form);
	return form;
}


</script>
{% endblock %}