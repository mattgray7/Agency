{% extends "base.html" %}

{% block content %}
{% load static %}
<link href="{% static "/AgencyApp/css/browse.css" %}" rel="stylesheet" type="text/css" media="all" />
<script type="text/javascript" src="{% static "/AgencyApp/js/profile.js" %}"></script>
<script type="text/javascript" src="{% static "/AgencyApp/js/post/post.js" %}"></script>
<script type="text/javascript" src="{% static "/AgencyApp/js/browse.js" %}"></script>

    <link href="{% static "/AgencyApp/css/image.css" %}" rel="stylesheet" type="text/css" media="all" />
    <link href="{% static "/AgencyApp/js/image/resources/jquery.selectareas.css" %}" media="screen" rel="stylesheet" type="text/css" />
    <script src="{% static "/AgencyApp/js/image/jquery.selectareas.js" %}"></script>
    <script type="text/javascript" src="{% static "/AgencyApp/js/image/image.js" %}"></script>

<!--<script type="text/javascript" src="{% static "/AgencyApp/js/profile.js" %}"></script>-->

<script>
var accountButtons = [{"label": "Profile", "destination": "{{possibleDestinations.profile}}"},
                      {"label": "Background", "destination": "{{possibleDestinations.background}}"},
                      {"label": "Filmography", "destination": "{{possibleDestinations.filmography}}"},
                      {"label": "Media", "destination": "{{possibleDestinations.picture}}"},
                      {"label": "Interests", "destination": "{{possibleDestinations.interests}}"}
                     ]
function createEditAccountButtonHeader(activeLabel){
    /*var headerString = "<div id='editAccountTypeButtons' style='width: 100%; text-align: center; height: 120px; background: #FFF; position: relative; margin-bottom: -5px;'>";

    // Add back to profile button
    headerString += "<div class='editButton' style='position: absolute; left: 10px; top: 10px; z-index: 5;' onclick='redirectToUser(" + '"{{request.user.username}}");' + "'>&lt; {{userAccount.cleanName}}</div>";

    // Add edit account buttons
    headerString += "<div style='position: absolute; left: 0; right: 0; top: 20px;'><div style=''><h1 style='margin-bottom: 10px;'>Edit Account</h1></div>"
    headerString += "<ul class='browseCategoriesList' style='display: inline-block; margin: 0px auto 0px auto; width: 440px;'>";
    for(var i=0; i < accountButtons.length; i++){
        headerString += "<li ";
        if(accountButtons[i]["label"] === activeLabel){
            headerString += "class='active' "
        }
        headerString += " style='width: 100px;' onclick='redirect(" +'"' + accountButtons[i]["destination"] +'");' + "'>" + accountButtons[i]["label"]  + "</li>";
    }
    headerString += "</ul></div></div>";
    return headerString;*/

    var headerString = "<div id='editAccountTypeButtons' style='width: 100%; text-align: center; height: 55px; background: #FFF; position: relative; margin-bottom: -5px;'>";

    // Add edit account buttons
    headerString += "<div style='width: 100%; margin: 0px auto 0px auto;'><ul class='browseCategoriesList' style='display: inline-block; margin-top: 10px; margin-left: 10px; width: 550px;'>";
    for(var i=0; i < accountButtons.length; i++){
        headerString += "<li ";
        if(accountButtons[i]["label"] === activeLabel){
            headerString += "class='active' "
        }
        headerString += " style='width: 100px;' onclick='redirect(" +'"' + accountButtons[i]["destination"] +'");' + "'>" + accountButtons[i]["label"]  + "</li>";
    }
    headerString += "</ul></div></div>";
    return headerString;
}

/************************ EDIT_BACKGROUND ***************************/

function removeResume(){
    var removeResumeInput = document.getElementById("removeResumeFileInput")
    if(removeResumeInput != null){
        removeResumeInput.value = "true";
    }

    var resumeContainer = document.getElementById("resumeContainer");
    if(resumeContainer != null){
        resumeContainer.innerHTML = "<input type='file' name='resume' />"
    }
}

function removeIMDBLink(){
    var container = document.getElementById("imdbLinkContainer")
    if(container != null){
        container.innerHTML = "<input type='text' name='imdb' value='' />"
    }
}

function submitForm(formName){
    var form = document.getElementById(formName)
    if(formName === "editBackgroundForm"){
        // Need to add chosen professions
        if(profileProfessionList.length > 0){
            var professionListInput = document.getElementById("profileProfessionListInput");
            professionListInput.value = JSON.stringify(profileProfessionList)
        }
    }
    return form.submit();
}

function getPhysicalAttributeFields(){
    var fieldString = '';
    {% if physicalAttributeData %}
        fieldString += "<li style='border:none; text-align: left; margin-bottom: -10px; margin-left: -8px;'><h2>Physical Attributes</h2><h4 style='margin: 4px 0px; font-weight: 200;'>By selecting a front-of-camera profession, you can specify some physical attributes increasing your exposure to casting agents!</h4></li>"
        {% for attributeDict in physicalAttributeData %}
            fieldString += "<li><label for='name'>{{attributeDict.label}}</label>";
            {% if attributeDict.options %}
                var options = {{ attributeDict.options|safe }};
                fieldString += "<select form='editBackgroundForm' name='{{attributeDict.name}}'>";
                for(var i=0; i < options.length; i++){
                    fieldString += "<option "
                    if(options[i] === "{{attributeDict.value}}"){
                        fieldString += "selected ";
                    }
                    fieldString += "'value='" + options[i] + "'>" + options[i] + "</option>"
                }
                fieldString += "</select>";
            {% elif attributeDict.name == "dateOfBirth" %}
                var date = new Date('{{attributeDict.value}}');
                var dateString = date.getFullYear() + "-" + ("0" + (date.getMonth() + 1)).slice(-2) + "-" + ("0" + date.getDate()).slice(-2);
                fieldString += "<input type='date' name='{{attributeDict.name}}' value='" + dateString + "'>";
            {% else %}
                var textValue = "{{attributeDict.value}}";
                if(textValue === "None"){
                    textValue = "";
                }
                fieldString += "<input type='text' name='{{attributeDict.name}}' /value='" + textValue + "'>"
            {% endif %}
            fieldString += "</li>"
        {% endfor %}
        fieldString += "<li style='display:none;'></li>"    //blank row so last attribute isn't flagged as last
    {% endif %}
    return fieldString;
}

var physicalAttributesRowHeight = 570;
function toggleDisplayPhysicalAttributesRow(toggleType){
    var container = document.getElementById("physicalAttributesRow");
    if(container != null){
        if(toggleType === "expand"){
            container.innerHTML = getPhysicalAttributeFields();
            $("#physicalAttributesRow").animate({marginTop: "0px", height: physicalAttributesRowHeight + "px"}, 500, function(){});
        }else{
            container.innerHTML = "";
            $("#physicalAttributesRow").animate({marginTop: "0px", height: "0px"}, 500, function(){});
        }
    }
}

/*******************************************************************/


/************************ EDIT_FILMOGRAPHY ***************************/

function getFormFieldString(fieldDict){
    var fieldString = '';
    if("label" in fieldDict && "name" in fieldDict && "id" in fieldDict){
        /*fieldString += "<div style='position: relative; height: 100%; width: 100%; text-align: right; '>"
        fieldString += "<div style='position: absolute; left: 0; right: 60%;'>" + fieldDict["label"] + "</div>"
        if("options" in fieldDict){
            // Do select field
        }else{
            fieldString += "<input type='text' style='position: absolute; left: 40%; right: 0;' />"
        }*/
        fieldString += "<label style='background: #f2f2f2;' for='name'>" + fieldDict["label"] + "</label>"
        if("options" in fieldDict){
            fieldString += "<select name='" + fieldDict["name"] + "' id='" + fieldDict["id"] + "'>"
            for(var i=0; i < fieldDict['options'].length; i++){
                fieldString += '<option name="' + fieldDict['options'][i] + '" ';
                if(fieldDict["value"] != null && fieldDict["value"] === fieldDict["options"][i]){
                    fieldString += 'selected ';
                }
                fieldString += '>' + fieldDict['options'][i] + '</option>';
            }
            fieldString += "</select>"
        }else{
            fieldString += "<input type='text' id='" + fieldDict["id"] + "' name='" + fieldDict["name"] + "' "
            if('placeholder' in fieldDict){
                fieldString += 'placeholder="' + fieldDict["placeholder"] + '" ';
            }
            if(fieldDict['value'] != null){
                fieldString += 'value="' + fieldDict['value'] + '" '
            }
            fieldString += " />";
        }
    }
    return fieldString;
}

var addNewRecordFormHeight = 350;
function getNewRecordFormString(recordData){
    var updateRecordType = "existing";
    var updateButtonText = "Update Project"
    var cancelButtonText = "Remove"
    var cancelButtonOnclickFunctionName = "removeRecord"
    var edit = true;
    var topHeight = 70;
    var formHeight = addNewRecordFormHeight;
    if(recordData == null){
        edit = false;
        recordData = {};
        updateRecordType = "new"
        updateButtonText = "Add Project"
        cancelButtonText = "Cancel"
        cancelButtonOnclickFunctionName = "cancel"
        topHeight = 50;
        formHeight -= 20;
    }
    var formDict = [{"name": "name", "label": "Name", 'value': recordData["name"], 'placeholder': 'Star Wars', "id": updateRecordType + "ProjectName"},
                    {"name": "projectType", "label": "Type", "value": recordData["projectType"], 'placeholder': 'Film - Feature', "id": updateRecordType + "ProjectType"},
                    {"name": "status", "label": "Status", "value": recordData["status"], 'placeholder': 'Post-production', "id": updateRecordType + "ProjectStatus"},
                    {"name": "profession", "label": "Profession", 'placeholder': 'Camera Operator', "id": updateRecordType + "ProjectProfession"},
                    {"name": "year", "label": "Year", "value": recordData["year"], 'placeholder': '2017', "id": updateRecordType + "ProjectYear"},
                    {},
                    ]
    {% if projectTypes %}
        formDict[1]["options"] = {{projectTypes|safe}};
    {% endif %}
    {% if projectStatusList %}
        formDict[2]["options"] = {{projectStatusList|safe}};
    {% endif %}
    if(recordData["labels"] != null && recordData["labels"].length > 0){
        formDict[3]["value"] = recordData["labels"][0]["label"];
    }

    var formString = "<div class='form-style-7' style='border: 1px solid rgba(0,0,0,0.3); background: #f2f2f2; border-radius: 3px;'><div style='position: relative; height: " + formHeight + "px; width: 100%'>"

    // Add title
    formString += "<div style='position: absolute; left: 0px; top: -10px; text-align: left;'><h2 style='margin-bottom: 5px;'>"
    if(edit){
        formString += "Edit Project";
    }else{
        formString += "Add Project"
    }

    formString += "</h2><h4 style='margin: 5px 0px; font-weight: 300;'>Add a simple record to your filmography, or register a new project <a onclick='redirect(" +'"{{possibleDestinations.createProject}}");' + "'>here</a>.</h4></div>"

    // Add left list
    // Special case: form sub-title fits on 1 line in new project panel, but not in edit panel
    formString += "<ul style='position: absolute; left: 0; right: 51%; top: " + topHeight + "px; bottom: 0;'>";
    for(var i=0; i < (formDict.length/2); i++){
        formString += "<li style='height: 30px; background: #f2f2f2;'>" + getFormFieldString(formDict[i]) + "</li>";
    }
    // Add cancel button
    formString += "<li style='margin-top: 15px; border: none; background: none; text-align: center; padding: 0;'><div id='" + updateRecordType + "CancelButton' onclick='returnToProfile();' class='whiteButton blackHover' style='padding: 6px; padding-top: 15px; width: 94%; height: 35px;'>" + cancelButtonText + "</div></li><li style='display: none;'></li></ul>";

    // Add right list
    formString += "<ul style='position: absolute; left: 51%; right: 0; top: " + topHeight + "px; bottom: 0;'>";
    for(var i=(formDict.length/2); i < formDict.length ; i++){
        if(formDict[i]["name"] != null){
            formString += "<li style='height: 30px; background: #f2f2f2;'>" + getFormFieldString(formDict[i]);
            if(formDict[i]["name"] === "profession"){
                // Add dropdown
                formString += '<div id="' + updateRecordType + 'ProjectProfessionDropdown" class="previewDropdownPanel" style="position: absolute; left: 5px; right: 6px; top: 69px; border: 1px solid #86898e; display: none; height: auto;"></div>'
            }
            formString += "</li>";
        }else{
            formString += "<li id='" + updateRecordType + "ErrorListContainer' style='height: 50px; border: none; background: none; padding: 0;'></li>"
        }
    }
    // Add button
    formString += "<li style='margin-top: 15px; border: none; background: none; text-align: center; padding: 0;'><div id='" + updateRecordType + "UpdateButton' class='whiteButton blackHover' style='padding: 6px; padding-top: 15px; width: 94%; height: 35px;' onclick='addNewRecord(" + '"' + updateRecordType + '", "' + recordData["projectID"] + '"' + ");'>" + updateButtonText + "</div></li><li style='display: none;'></li></ul>";

    formString += "</div></div>"
    return formString
}

function clearAddNewRecordForm(){
    var name = document.getElementById("newProjectName");
    var type = document.getElementById("newProjectType");
    var status = document.getElementById("newProjectStatus");
    var profession = document.getElementById("newProjectProfession");
    var year = document.getElementById("newProjectYear");
    var errorPanel = document.getElementById("newErrorListContainer");
    if([name, type, status, profession, year, errorPanel].indexOf(null) === -1){
        name.value = '';
        profession.value = '';
        year.value = '';
        status.value = 'Pre-production';
        type = 'Film - Feature';
        errorPanel.innerHTML = '';
    }
}

function addNewRecord(recordType, projectID){
    var name = document.getElementById(recordType + "ProjectName");
    var type = document.getElementById(recordType + "ProjectType");
    var status = document.getElementById(recordType + "ProjectStatus");
    var profession = document.getElementById(recordType + "ProjectProfession");
    var year = document.getElementById(recordType + "ProjectYear");

    if(projectID === "undefined"){
        // Special case when passing null dict values through js as strings
        projectID = null;
    }
    if([name, type, status, profession, year].indexOf(null) === -1){
        var newProjectDict = {};
        var errorList = [];
        var invalidList = []
        if(name.value == null || name.value.length === 0){
            invalidList.push("project name")
        }
        if(isNaN(year.value) || year.value.length != 4){
            invalidList.push("year")
        }
        if(profession.value == null || profession.value.length === 0){
            invalidList.push("profession")
        }
        if(invalidList.length > 0){
            var error = "Invalid inputs: ";
            for(var i=0; i < invalidList.length; i++){
                error += invalidList[i] + ", "
            }
            error = error.substring(0, error.length-2) + ".";
            errorList.push(error)
        }

        if(errorList.length === 0){
            $.ajax({
                url : "/ajax/createUnregisteredProject/",
                data : {"name": name.value, "type": type.value, "status": status.value, "profession": profession.value, "year": year.value, "projectID": projectID},
                type : 'POST',
                dataType: "json",
                success : function(data) {
                    if(data["success"]){
                        newProjectDict["name"] = name.value;
                        newProjectDict["postPictureURL"] = "{{images.noPicture}}";
                        newProjectDict["status"] = status.value
                        newProjectDict["projectType"] = type.value;
                        newProjectDict["labels"] = [{"label": profession.value}];
                        newProjectDict["year"] = year.value;
                        newProjectDict["projectID"] = data["postID"];

                        profileProjects[data["postID"]] = newProjectDict;
                        var listContent = document.getElementById("profileProjectsListContent");
                        if(listContent != null){
                            if(projectID != null){
                                // Editing
                                toggleExpandEditRecord("shrink", projectID, function(){
                                    var existingRow = document.getElementById("projectFeedRow_" + projectID);
                                    if(existingRow != null){
                                        existingRow.innerHTML = createProjectFeedElement(newProjectDict, true);
                                    }
                                })
                            }else{
                                clearAddNewRecordForm();
                                listContent.innerHTML = createProjectFeed(profileProjects, true)
                            }
                        }
                    }
                }
            });
        }else{
            var errorListContainer = document.getElementById(recordType + "ErrorListContainer");
            if(errorListContainer != null){
                var errorString = "<ul class='errorPanel' style='height: 93%; width: 98%; border-radius: 5px;'>"
                for(var i=0; i < errorList.length; i++){
                    errorString += "<li style='border: none; margin: 0px 3px; padding: 0; text-align: left; background: none; height: auto;'>" + errorList[i] + "</li>";
                }
                errorString += "<li style='display:none;'></li></ul>";
                errorListContainer.innerHTML = errorString;
            }
        }
    }
}

var toggleSpeed = 300;
function toggleExpandEditRecord(toggleType, projectID, animationFinishCallback){
    var row = document.getElementById("projectFeedRow_" + projectID);
    var editContainer = document.getElementById("editRecordContainer_" + projectID)
    var editButton = document.getElementById("editButton_" + projectID)

    if(row != null && editContainer != null && editButton != null){
        if(toggleType === "expand"){
            $("[id='projectFeedRow_" + projectID + "']").animate({marginTop: "0px", height: "497px"}, toggleSpeed, function(){
                 if(animationFinishCallback != null){
                    animationFinishCallback();
                }
            });
            editContainer.style.display = "block";
            editContainer.innerHTML = getNewRecordFormString(profileProjects[projectID])
            
            // Need to add cancel function after button is written
            var cancelButton = document.getElementById("existingCancelButton");
            if(cancelButton != null){
                cancelButton.onclick = function(){
                    removeRecord(projectID);
                }
            }

            // Need to update edit button
            editButton.innerHTML = "Hide"
            editButton.onclick = function(){
                toggleExpandEditRecord("shrink", projectID)
            }

            // Need to add dropdown callback
            addProfileProfessionDropdownCallback("searchPreviewProfessions", {}, "existingProjectProfession", "existingProjectProfessionDropdown", false)
        }else{
            $("[id='projectFeedRow_" + projectID + "']").animate({marginTop: "0px", height: "100px"}, toggleSpeed, function(){
                editContainer.style.display = "none";
                if(animationFinishCallback != null){
                    animationFinishCallback();
                }
            });

            editButton.innerHTML = "Edit"
            editButton.onclick = function(){
                toggleExpandEditRecord("expand", projectID)
            }
        }
    }
}

function removeRecord(projectID){
    if(projectID in profileProjects){
        delete profileProjects[projectID];

        $.ajax({
            url : "/ajax/deleteUnregisteredProject/",
                data : {"projectID": projectID},
                type : 'POST',
                dataType: "json",
                success : function(data) {
                    if(data["success"]){
                        if(projectID != null){
                            toggleExpandEditRecord("shrink", projectID, function(){
                                var listContent = document.getElementById("profileProjectsListContent");
                                if(listContent != null){
                                    listContent.innerHTML = createProjectFeed(profileProjects, true)
                                }
                            });
                        }
                    }
                }
        });
    }
}

/*******************************************************************/


/************************ EDIT_MEDIA ***************************/
var existingOtherMediaPictures = [];

function addOtherMediaPicture(){
    var pictureID = "otherMediaPicture";
    var formName = "otherMediaPictureForm";
    var newPhotoForm = document.getElementById(formName)
    var newPhoto = document.getElementById("otherMediaPictureFile");
    var newPhotoDescription = document.getElementById("otherMediaPictureDescription");
    var addNewButton = document.getElementById("addOtherMediaButton");
    if(newPhoto != null && newPhotoDescription != null && newPhotoForm != null && addNewButton != null){
        if(newPhoto.value != null && newPhoto.value != ""){

            addNewButton.innerHTML = "<img src='{{images.loading.mid}}' style='position: absolute; height: 60px; width: 60px; margin-top: -15px; left: 25%;'>";

            newPhotoForm = addCropToPictureForm(formName, pictureID, pictureID + "CropInfoInputs");
            var formData = new FormData(newPhotoForm)
            if(newPhotoForm != null){
                $.ajax({
                    url : "/ajax/saveProfileMediaPicture/",
                    data : formData,
                    type : 'POST',
                    dataType: "json",
                    cache: false,
                    contentType: false,
                    processData: false,
                    success : function(data) {
                        if(data["success"] && data["pictureURL"]){
                            addNewButton.innerHTML = "Add photo";

                            var displayImage = document.getElementById(pictureID)
                            if(existingOtherMediaPictures.length === 0){
                                $("#otherMediaPictureList").animate({marginTop: "0px", height: "218px"}, 300, function(){});
                            }
                            console.log(data["featured"])
                            existingOtherMediaPictures.unshift({"id": data["pictureID"], "pictureURL": data["pictureURL"], "description": newPhotoDescription.value, "featured": data["featured"]})
                            var photoList = document.getElementById("otherMediaPictureList");
                            if(photoList != null){
                                photoList.innerHTML = getOtherMediaPictureList();
                            }
                            resetOtherMediaPictureForm();
                        }
                    }
                });
            }
        }else{
            console.log("no photo added")
        }
    }
}

function deleteOtherMediaPicture(pictureID){
    $.ajax({
        url : "/ajax/deleteProfileMediaPicture/",
                data : {"pictureID": pictureID},
                type : 'POST',
                dataType: "json",
                success : function(data) {
                    if(data["success"]){
                        for(var i=0; i < existingOtherMediaPictures.length; i++){
                            if(existingOtherMediaPictures[i]["id"] === pictureID){
                                existingOtherMediaPictures.splice(i, 1);
                                break;
                            }
                        }
                        var photoList = document.getElementById("otherMediaPictureList");
                        if(photoList != null){
                            if(existingOtherMediaPictures.length === 0){
                                // Shrink the panel and write empty list html after animation
                                $("#otherMediaPictureList").animate({marginTop: "0px", height: "40px"}, 300, function(){photoList.innerHTML = getOtherMediaPictureList();});
                            }else{
                                // No animation, so just update the list
                                photoList.innerHTML = getOtherMediaPictureList();
                            }
                        }
                    }
                }
        });
}

function resetOtherMediaPictureForm(){
    var pictureID = "otherMediaPicture";
    var pictureURL = "{{images.noPicture}}";

    // Reset form values
    var newPhoto = document.getElementById("otherMediaPictureFile");
    var newPhotoDescription = document.getElementById("otherMediaPictureDescription");
    newPhoto.value = '';
    newPhotoDescription.value = '';

    // Reset crop photo window
    pictureExistsMap[pictureID] = false;
    setNewPictureObject(pictureID, pictureURL, false)
    loadImage(pictureID, pictureURL)
    selectMainArea(pictureID)
}

function loadMediaPictureCropTool(){
    var pictureID = "otherMediaPicture";
    var pictureURL = "{{images.noPicture}}";
    setDoesPictureExist(pictureID, "")
    setNewPictureObject(pictureID, pictureURL)

    $("#otherMediaPictureFile").change(function(){
        if(this.value != null && this.value.length > 0){
            pictureExistsMap[pictureID] = true;
            previewEditPicture(pictureID, this, function(){});
        }else{
            /*{% if not userAccount or not userAccount.profilePicture or not userAccount.profilePicture.url %}
                pictureExistsMap[pictureID] = false;
            {% endif %}*/
            if(pictureURL.length > 0){
                setNewPictureObject(pictureID, pictureURL, true)
                loadImage(pictureID, pictureURL)
                selectMainArea(pictureID)
            }
        }
    });
}

function loadPictureCropTool(){
    var pictureID = "profilePicture";
    var pictureURL = "";
    setDoesPictureExist(pictureID, "{{userAccount.profilePicture}}")

    {% if userAccount.profilePicture and userAccount.profilePicture.url %}
        pictureURL = "{{userAccount.profilePicture.url}}"
    {% else %}
        pictureURL = "{{images.noProfilePicture}}"
    {% endif %}
    setNewPictureObject(pictureID, pictureURL)

    $("#id_profilePicture").change(function(){
        if(this.value != null && this.value.length > 0){
            pictureExistsMap[pictureID] = true;
            previewEditPicture(pictureID, this, function(){
                // Update the height of the pp panel so that if picture height shrinks, other panels will be raised to compensate
                var pictureDiv = document.getElementById("profilePictureDiv");
                var picturePanel = document.getElementById("profilePicturePanel");
                if(pictureDiv != null && picturePanel != null){
                    picturePanel.style.height = pictureDiv.offsetHeight + 100 + "px";
                }
            });
        }else{
            {% if not userAccount or not userAccount.profilePicture or not userAccount.profilePicture.url %}
                pictureExistsMap[pictureID] = false;
            {% endif %}
            if(pictureURL.length > 0){
                setNewPictureObject(pictureID, pictureURL, true)
                loadImage(pictureID, pictureURL)
                selectMainArea(pictureID)
            }
        }
    });
}

function updateFeaturedPhotoStatus(input){
    var pictureID = input.id.replace("featuredCheckbox_", "");
    var checked = input.checked;
    $.ajax({
        url : "/ajax/updateProfileMediaPictureFeaturedStatus/",
        data : {"pictureID": pictureID, "isFeatured": checked},
        type : 'POST',
        dataType: "json",
        success : function(data) {
            if(data["success"]){
                console.log("success")
            }else{
                if(data["errors"]){
                    input.checked = !checked;
                    var errorString = ""
                    for(var i=0; i < data["errors"].length; i++){
                        errorString += data["errors"][i]
                    }

                    // Alert breaks code execution, so need to use timeout so input checked has time to update before alerting
                    setTimeout(function() { alert(errorString); }, 50);
                }
            }
        }
    });
}


/*******************************************************************/
</script>


    {% if errors %}
        <ul>
            {% for error in errors %}
                <li>{{ error }}</li>
            {% endfor %}
        </ul>
    {% endif %}

    <script>
        function submitFormWithExtraParameters(formType){
            // Submits the submit profession button
            var extraInputs = []
            extraInputs.push({key: "interestType", value: formType})
            if(formType === "work"){
                for(var i=0; i < chosenProfessionList.length; i++){
                    extraInputs.push({key: "profession." + chosenProfessionList[i], value: true})
                }
                for(var i=0; i < selectedAvailableWeekdays.length; i++){
                    extraInputs.push({key: "availability.weekday." + selectedAvailableWeekdays[i], value: true})
                }
                var formattedDatesList = []
                for(var i=0; i < selectedDates.length; i++){
                    formattedDatesList.push(selectedDates[i]["year"] + "-" + selectedDates[i]["month"] + "-" + selectedDates[i]["day"])
                }
                extraInputs.push({key: "availability.datesList" + JSON.stringify(formattedDatesList), value: true})
            }else if(formType === "hire"){
                for(hireType in chosenHireTypes){
                    if(chosenHireTypes[hireType] == true){
                        extraInputs.push({key: "hireType." + hireType, value: true})
                    }
                }
            }
            var form = createPageRedirectForm("{{next}}", "{{next}}", "{{destination}}", "{{currentPageURL}}", extraInputs, null);
            form.submit();
        }

        function returnToProfile(){
            var form = createPageRedirectForm("{{ next }}", "{{ next }}", "{{ possibleDestinations.profile }}", "/user/{{request.user.username}}/", [], null, null)
            form.submit()
        }
    </script>
{% if next == possibleDestinations.filmography %}
     <div id='backgroundPanel' class='backgroundPanel' style='min-width: 634px; min-height: 100%;'>
        <div id="mainViewPanel" class="mainViewPanel" style="position: relative; min-width: 620px; max-width: 620px; background: rgba(0,0,0,0.05); border: none;">
            <script>
            var profileProjects = {};
            document.write(createEditAccountButtonHeader("Filmography"))
            </script>

            <div id='editFilmographyContainer' style='text-align: center; background: #FFF; padding: 10px 0px;'>
                <!--<h2> Filmography </h2>-->
                <div id='addNewRecordContainer' style='width: 87%; margin: 10px auto;'>
                    <script>
                        document.write(getNewRecordFormString(null));
                        addProfileProfessionDropdownCallback("searchPreviewProfessions", {}, "newProjectProfession", "newProjectProfessionDropdown", false)
                    </script>
                </div>

                {% if profileProjects %}
                    <div style='height: 20px;'></div>
                    <div id='profileProjectsList' style='width: 80%; margin: 10px auto; border: 1px solid rgba(0,0,0,0.3); border-radius: 3px; padding: 20px; position: relative; background: #f2f2f2;'>
                        <div style='position: absolute; top: 10px; left: 20px;'><h2>Filmography</h2></div>

                        <div id='profileProjectsListContent' style='margin-top: 30px;'>
                            <script>
                                profileProjects = {{profileProjects|safe}};
                                document.write(createProjectFeed(profileProjects, true))
                            </script>
                        </div>
                    </div>
                {% endif %}

            </div>
        </div>
    </div>

{% elif next == possibleDestinations.background %}
    <div id='backgroundPanel' class='backgroundPanel' style='min-width: 634px; min-height: 100%;'>
        <div id="mainViewPanel" class="mainViewPanel" style="position: relative; min-width: 620px; max-width: 620px; background: rgba(0,0,0,0.05); border: none;">
            <script>
            document.write(createEditAccountButtonHeader("Background"))
            </script>

                <form class="form-style-7" id="editBackgroundForm" method="post" action="{{ currentPageURL }}" enctype="multipart/form-data">
                    {% csrf_token %}
                    <ul>
                        <li style='border: none; padding: 0px; margin: 0px; text-align: left;'><h2>Basic Info</h2><h4 style='margin: 4px 0px; font-weight: 200;'>Add details about your past career history.</h4></li>
                        <script>

                            {% for field in form %}
                                var lineString = '';
                                if('{{field}}'.indexOf("hidden") === -1){
                                    lineString = "<li><label for='name'>{{field.label}}</label>";
                                    if("{{field.name}}" != "bio"){
                                        {% if selectFields and field.name in selectFields %}
                                            var selectFields = {{selectFields|safe}}
                                            if("{{field.name}}" in selectFields){
                                                lineString += "<select form='editBackgroundForm' name='{{field.name}}'>";
                                                for(var i=0; i < selectFields["{{field.name}}"].length; i++){
                                                    lineString += "<option "
                                                    if(selectFields["{{field.name}}"][i] === "{{field.value}}"){
                                                        lineString += "selected ";
                                                    }
                                                    lineString += "'value='" + selectFields["{{field.name}}"][i] + "'>" + selectFields["{{field.name}}"][i] + "</option>"
                                                }
                                                lineString += "</select>";
                                            }
                                        {% else %}
                                            if("{{field.name}}" === "resume"){
                                                lineString += '<input type="hidden" id="removeResumeFileInput" name="removeResumeFile" value="false" /><div id="resumeContainer" style="text-align: left; position: relative;">'
                                                if('{{field.value}}'.length > 0){
                                                    lineString += '<a href="/media/{{field.value}}">'

                                                    // Remove parent directory from resume link to just show filename
                                                    lineString += '{{field.value}}'.replace('{{request.user.username}}/', '');
                                                    lineString += '</a><div style="position: absolute; right: 0; top: 0;"><a onclick="removeResume();">Clear</a></div>';
                                                }else{
                                                    lineString += '{{field}}'
                                                }
                                                lineString += "</div>"
                                            }else if("{{field.name}}" === "imdbLink"){
                                                lineString += "<div id='imdbLinkContainer' style='height: 25px; text-align: left; position: relative;'>";
                                                if("{{field.value}}".length > 0 && "{{field.value}}" != "None"){
                                                    lineString += "<a href='{{field.value}}'>{{userAccount.cleanName}}</a><div style='position: absolute; right: 0; top: 0;'><a onclick='removeIMDBLink();'>Clear</a></div><input type='hidden' name='imdbLink' value='{{field.value}}' />";
                                                }else{
                                                    lineString += '{{field}}';
                                                }
                                            }else if("{{field.name}}" === "profileProfessions"){
                                                // Add container
                                                lineString += '<div style="position: relative; height: 23px; margin-top: 3px; margin-left: -6px;">'

                                                // Add text field
                                                lineString += '<input style="position: absolute; top: 0; left: 7px; right: 0; background: rgba(255,255,255,0);" type="text" id="profileProfessionTextInput">';

                                                // Add hidden input
                                                lineString += '<input type="hidden" name="professionList" id="profileProfessionListInput">';

                                                // Add dropdown
                                                lineString += '<div id="profileProfessionDropdown" class="previewDropdownPanel" style="position: absolute; left: 0; right: 0; margin-right: -5px; margin-left: -1px; top: 31px; border: 1px solid #86898e; display: none; ;"></div>'

                                                // Add profession container
                                                lineString += '<div id="profileProfessionContainer" style="position: absolute; top: 0; left: 0; bottom: 0; background: rgba(0,0,0,0);"></div>';

                                                lineString += "</div>"
                                            }else{
                                                lineString += '{{field}}';
                                            }
                                        {% endif %}
                                    }else{
                                        lineString += "<textarea cols='100' rows ='20' name='bio' form='editBackgroundForm' style='height:100px;'> {{ field.value }}</textarea>"
                                    }
                                    lineString += "</li>";
                                }else{
                                    lineString += '{{field}}';
                                }
                                document.write(lineString);
                                addProfileProfessionDropdownCallback("searchPreviewProfessions", {}, "profileProfessionTextInput", "profileProfessionDropdown", true)
                            {% endfor %}



                        </script>
                        <div id="physicalAttributesRow" style="height: 0px; border: none;"></div>
                        <li style="position:relative; height:70px; border: none; padding: 0;">
                            <div id="cancel" class="whiteButton blackHover" style="position: absolute; left: 0; right: 51%; top: 0;" onclick='cancelPage();'>Cancel</div>
                            <div id="continueButton" class="whiteButton blackHover" style="position: absolute; right: 0; left: 51%; top: 0;" onclick="submitForm('editBackgroundForm')">
                                Continue
                            </div>

                        </li>
                    </ul>
                </form>
            </div>
        </div>
        <script>
            $(window).on("load", function (){
                {% if profileProfessions %}
                    profileProfessionList = {{ profileProfessions|safe }};
                {% endif %}
                displayProfileProfessionList("profileProfessionContainer", "profileProfessionTextInput")

                if(profileProfessionList.length > 0){
                    var displayPhysicalAttributes = false;
                    {% if physicalAttributeProfessions %}
                        performerProfessions = {{ physicalAttributeProfessions|safe }};
                        {% for profession in physicalAttributeProfessions %}
                            if(profileProfessionList.indexOf("{{profession}}") > -1){
                                displayPhysicalAttributes = true;
                            }
                        {% endfor %}
                    {% endif %}
                    if(displayPhysicalAttributes){
                        toggleDisplayPhysicalAttributesRow("expand");
                    }
                }
            });

        </script>
{% elif next == possibleDestinations.picture %}
    <script>
        function skipProfilePicture(){
            var extraInputs = []
            extraInputs.push({key: "{{ cancel }}", value: "True"});
            var form = createPageRedirectForm("{{next}}", "{{next}}", "{{cancelDestination}}", "{{currentPageURL}}", extraInputs, null);
            form.submit();
        }

        function removeProfilePicture(){
            $.ajax({
                url : "/ajax/deleteProfilePicture/",
                data : {},
                type : 'POST',
                dataType: "json",
                success : function(data) {
                    returnToProfile();
                }
            });
        }
    </script>
    <div id='backgroundPanel' class='backgroundPanel' style='min-width: 634px; min-height: 100%;'>
        <div id="mainViewPanel" class="mainViewPanel" style="position: relative; min-width: 600px; max-width: 600px; background: rgba(0,0,0,0.05); border: none;">
            <script>
            document.write(createEditAccountButtonHeader("Media"))
            </script>

            <center>
                <div id="profilePicturePanel" class="editProfilePicturePanel" style="height: 400px;">
                    {% if userAccount and userAccount.profilePicture %}
                        <h2> Edit Profile Picture </h2>
                    {% else %}
                        <h2> Add Profile Picture </h2>
                    {% endif %}
                    <br>
                    
                    <center>
                        <div style='position: relative; width: 300px;'>
                            <div id="profilePictureLoadingPictureGrayOverlay" class="hiddenGrayPopupOverlay" style="background: rgba(0,0,0,0); height:0%; width:0%; position: absolute; margin-left: 0px; margin-top: 11px; top:0; z-index: 3">
                                <img id='profilePictureLoadingGif' src='{{images.loading.light}}' style='height: 40px; width: 40px; display: none; margin-top: 52%; margin-left: 2%;'></div>
                        </div>
                        <div id="profilePictureDiv" class="profilePictureDiv" style='width: 300px;'>
                            <!-- Image div created in loadImage() -->
                        </div>
                    </center>
                    <br>

                    <form method="post" id="editPictureForm" action="{{ currentPageURL }}" enctype="multipart/form-data" style="text-aslign: center; margin-top: -10px;">
                        {% csrf_token %} 
                        {{ form.as_p }}

                        {% if userAccount and userAccount.profilePicture %}
                            <div id="removeButton" class="whiteButton blackHover" style="width:24.1%; height:28px;" onclick="removeProfilePicture();">
                                Remove
                            </div>
                        {% else %}
                            <div id="skipButton" class="whiteButton blackHover" style="width:24.1%; height:28px;" onclick="skipProfilePicture();">
                                Skip
                            </div>
                        {% endif %}
                        <div id="continueButton" class="whiteButton blackHover" style="width:24.1%; height:28px" onclick="submitPictureFormWithCrop('editPictureForm', 'profilePicture')">
                            Update
                        </div>
                        <div id="profilePictureCropInfoInputs"></div>
                    </form>
                </div>
            </center>
            <div style='height: 100px; background: #FFF;'></div>
            <div id='otherMediaPanel' style='background: #FFF; position: relative; padding-bottom: 10px;'>
                <h2> Other Media</h2>
                <div id='photosPanel' style='margin-left: 20px; margin-right: 20px; margin-top: 5px; border: 1px solid rgba(0,0,0,0.1); border-radius: 3px; background: rgba(0,0,0,0.03)'>
                        <h3 style='margin: 0px 5px; text-align: left;'>
                            Photos
                        </h3>

                        <div id='otherMediaPictureListPanel' style='max-height: 230px;'>
                            <div id='otherMediaPictureList' style='text-align: left; max-height: 230px; overflow-x: scroll; overflow-y: hidden; white-space: nowrap;'>
                                {% if profileMediaPictures %}
                                    <script>
                                        {% for picture in profileMediaPictures %}
                                            existingOtherMediaPictures.push({"pictureURL": "{{picture.url}}", "id": "{{picture.id}}", "description": "{{picture.description}}", "featured": "{{picture.featured}}"})
                                        {% endfor %}
                                        document.write(getOtherMediaPictureList())
                                    </script>
                                {% else %}
                                    <script>
                                        document.write(getEmptyMediaPictureList());
                                    </script>
                                {% endif %}
                            </div>
                        </div>

                        <div id='otherMediaPicturePanel' style='position: relative: height: 270px; text-align: left; background: #FFF; border: 1px solid rgba(0,0,0,0.1);'>
                            <div style='position: relative; height: 100%;'>
                                <form id='otherMediaPictureForm' method='post' enctype="multipart/form-data" class='form-style-7' style='width: 53%; margin-left: 0px; display:'>
                                    <ul>
                                        <script>
                                            var newPictureFields = [{"label": "New File", "type": "file", "name": "otherMediaPictureFile"},
                                                                  {"label": "Caption", "type": "text", "name": "otherMediaPictureDescription"}]
                                            for(var i=0; i < newPictureFields.length; i++){
                                                var newString = "<li style='height: 30px;'><label for='name'>" + newPictureFields[i]["label"] + "</label><input type='" + newPictureFields[i]["type"] + "' name='" + newPictureFields[i]["name"] + "' id='" + newPictureFields[i]["name"] + "'></li>"
                                                document.write(newString)
                                            }
                                        </script>
                                        <li style='border: none; margin-top: 15px; padding: 0px 0px;'>
                                            <div id="addOtherMediaButton" class="whiteButton blackHover" style="display: block; height:28px; text-align: center; padding: 0.7em 3em;" onclick="addOtherMediaPicture();">
                                                Add photo
                                            </div>
                                        </li>
                                    </ul>
                                    <div id="otherMediaPictureCropInfoInputs"></div>
                                </form>        
                            </div>
                            <div style='position: absolute; left: 60%; right: 10px; bottom: 10px;  border: 1px solid rgba(0,0,0,0.0); background: none; width: 207px; height: 230px; text-align: center; display: table;'>
                                <div style='display: table-cell; vertical-align: middle;'>
                                    <div style='position: relative; width: 300px;'>
                                        <div id="otherMediaPictureLoadingPictureGrayOverlay" class="hiddenGrayPopupOverlay" style="background: rgba(0,0,0,0); height:0%; width:0%; position: absolute; margin-left: -10px; margin-top: 11px; top:0; z-index: 3; text-align: center;">
                                            <img id='otherMediaPictureLoadingGif' src='{{images.loading.light}}' style='height: 40px; width: 40px; display: none; margin-top: 52%; margin-left: 42%;'>
                                        </div>
                                </div>
                                    <div id="otherMediaPictureDiv" class="profilePictureDiv" style='width: 200px; max-width: 200px; text-align: left;'>
                                        <!-- Image div created in loadImage() -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <script>
                loadPictureCropTool();
                loadMediaPictureCropTool();
            </script>
        </div>
    </div>
{% elif next == possibleDestinations.interests %}
<script type="text/javascript" src="{% static "/AgencyApp/js/calendar.js" %}"></script>
<link href="{% static "/AgencyApp/css/calendar.css" %}" rel="stylesheet" type="text/css" media="all" />

<script>
var interestPanelWidthThreshold = 820;
var interestPanelExpanded = true;

function getInterestButtonInfo(){
     // Get button texts
    var buttonTexts = {"left": "Looking for a job", "center": "Hiring, casting, or collaborating", "right": "Other"}
    var buttonClasses = {"left": "toggleButton", "center": "toggleButton", "right": "toggleButton"}
    var buttonDescriptions = {"left": "Look for a job in the Vancouver film industry in anything from acting to set work to post production. Your profile will be public to casting agents and those looking to hire.", "center": "Create casting posts and job posts for both permanent and project-specific positions. You can also post in search of collaborators for a new project.", "right": "Explore the film industry around you. Check out local events, view projects that are currently being shot in Vancouver, and find your next project!"}
    {% if existingProfessions or existingHiringInterests %}
        {% if existingProfessions %}
            buttonTexts["left"] += " &#10004;"
            buttonClasses["left"] += " enabled"
            chosenInterests["work"] = true;
        {% endif %}
        {% if existingHiringInterests %}
            buttonTexts["center"] += " &#10004;"
            buttonClasses["center"] += " enabled"
            chosenInterests["hiring"] = true;
        {% endif %}
    {% else %}
        buttonTexts["right"] += " &#10004;";
        buttonClasses["right"] += " enabled"
        chosenInterests["other"] = true;
    {% endif %}

    return {"text": buttonTexts, "class": buttonClasses, "description": buttonDescriptions}
}


function getWideInterestPanel(){
    var panelString = '<div id="mainViewPanel" class="mainViewPanel" style="position: relative; width: 70%; min-width: 800px; max-width: 940px; background: rgba(0,0,0,0.05); border: none;">' + createEditAccountButtonHeader("Interests") + '<div id="interestPanel" style="height: 100%; width: 100%;">';

    // Add container
    panelString += '<div id="wrapper"><div id="three-column" class="container" style="width: 740px; margin-bottom: 20px;">'

    // Add title
    panelString += '<div class="title"><h2>What are you interested in?</h2><span class="byline">Let others know what you are looking for</span></div>'

    var buttonInfo = getInterestButtonInfo();
    // Add left panel
    panelString += '<div class="boxA"><h2>Job Seeking</h2><div style="height: 110px;"><img src="{{images.icons.jobSeeking}}" style="max-height: 60px; max-width: 60px; margin-top: 30px;" /></div><p>' + buttonInfo["description"]["left"] + '</p><div id="workInterestButton" class="' + buttonInfo["class"]["left"] + '" style="height: 40px; padding-top: 20px; margin: 40px 5px 10px 5px;" onclick="selectInterest(' + "'work'" +  ');">' + buttonInfo["text"]["left"] + '</div></div>'

    // Add center panel
    panelString += '<div class="boxB"><h2>Casting and Hiring</h2><div style="height: 110px;"><img src="{{images.icons.hiringCasting}}" style="max-height: 60px; max-width: 60px; margin-top: 25px;" /></div><p>' + buttonInfo["description"]["center"] + '</p><div id="hiringInterestButton" class="' + buttonInfo["class"]["center"] + '" style="height: 40px; padding-top: 20px; margin: 40px 5px 10px 5px;" onclick="selectInterest(' + "'hiring'" + ');">' + buttonInfo["text"]["center"] + '</div></div>'

    // Add right panel
    panelString += '<div class="boxC"><h2> Explore </h2><div style="height: 110px;"><img src="{{images.icons.explore}}" style="max-height: 55px; max-width: 60px; margin-top: 25px;" /></div><p>' + buttonInfo["description"]["right"] + '</p><div id="otherInterestButton" class="' + buttonInfo["class"]["right"] + '" style="height: 40px; padding-top: 20px; margin: 40px 5px 10px 5px;" onclick="selectInterest(' + "'other'" + ');">' + buttonInfo["text"]["right"] + '</div></div>'

    // Close three-column container
    panelString += '</div>';

    // Close wrapper container
    panelString += "</div>"

    // Close interests container
    panelString += "</div>";

    // Add second level
    panelString += "<div id='secondLevelViewPanel' style='height: 0px; width: 100%; background: #FFF; overflow: hidden;'></div>"

    // Add third level
    panelString += "<div id='thirdLevelViewPanel' style='height: 0px; width: 100%; background: #FFF; overflow: hidden;'></div>"

    // Close main view panel
    panelString += "</div>"
    return panelString
}

function getSlimInterestPanel(){
    var panelString = '<div id="mainViewPanel" class="mainViewPanel" style="position: relative; width: 95%; max-width: 600px; background: rgba(0,0,0,0.05); border: none;"><div id="interestPanel" style="height: 100%; width: 100%; color: rgba(0,0,0,0.6);" class="three-column">';

    // Title panel
    panelString += "<div style='height: 80px; background: #FFF; margin-bottom: 0; padding-top: 20px; padding-bottom: 30px;' class='title'><h2 style='color: rgba(0,0,0,0.7);'>What are you interested in?</h2><span class='byline' style='color: rgba(0,0,0,0.6);'>Let others know what you are looking for</span></div>";

    var buttonInfo = getInterestButtonInfo()

    // Top panel
    panelString += "<div id='workInterestSlimContainer' style='height: 250px; width: 100%; background: rgba(255,255,255,0.7); position: relative;'><div style='position: absolute; right: 50px; top: 80px;'><img src='{{images.icons.jobSeeking}}' style='max-height: 100px; max-width: 100px;' /></div><div style='position: absolute; left: 20px; right: 200px; top: 20px;'><h2 style='margin-bottom: 10px;'>Job Seeking</h2><p>" + buttonInfo["description"]["left"] + "</p>" + '<div id="workInterestButton" class="' + buttonInfo["class"]["left"] + '" style="height: 30px; padding-top: 10px; margin: -5px auto 0 auto; width: 60%; left: 0; right: 0; " onclick="selectInterest(' + "'work'" +  ');">' + buttonInfo["text"]["left"] + '</div></div><div id="workInterestExpandPanel" style="position: absolute; top: 250px; width: 100%;"></div></div>';

    // Middle panel
    panelString += "<div id='hiringInterestSlimContainer' style='height: 250px; width: 100%; background: rgba(255,255,255,1); position: relative;'><div style='position: absolute; right: 50px; top: 80px;'><img src='{{images.icons.hiringCasting}}' style='max-height: 100px; max-width: 100px;' /></div><div style='position: absolute; left: 20px; right: 200px; top: 20px;'><h2 style='margin-bottom: 10px;'>Hiring and Casting</h2><p>" + buttonInfo["description"]["center"] + "</p>" + '<div id="hiringInterestButton" class="' + buttonInfo["class"]["center"] + '" style="height: 30px; padding-top: 10px; margin: -5px auto 0 auto; width: 60%; left: 0; right: 0; " onclick="selectInterest(' + "'hiring'" +  ');">' + buttonInfo["text"]["center"] + '</div></div><div id="hiringInterestExpandPanel" style="position: absolute; top: 250px; width: 100%;"></div></div>';

    // Bottom panel
    panelString += "<div id='otherInterestSlimContainer' style='height: 250px; width: 100%; background: rgba(255,255,255,0.7); position: relative;'><div style='position: absolute; right: 50px; top: 80px;'><img src='{{images.icons.explore}}' style='max-height: 100px; max-width: 100px;' /></div><div style='position: absolute; left: 20px; right: 200px; top: 20px;'><h2 style='margin-bottom: 10px;'>Explore</h2><p>" + buttonInfo["description"]["right"] + "</p>" + '<div id="otherInterestButton" class="' + buttonInfo["class"]["right"] + '" style="height: 30px; padding-top: 10px; margin: -5px auto 0 auto; width: 60%; left: 0; right: 0; " onclick="selectInterest(' + "'other'" +  ');">' + buttonInfo["text"]["right"] + '</div></div></div>';

    panelString += "<div style='background: #FFF; height: 80px; padding-top: 10px;'>" + getSecondLevelButtons() + "</div>";

    panelString += "</div></div>"
    return panelString;
}

function resizeInterestPanel(force){
    if($(window).width() > interestPanelWidthThreshold){
        if(!interestPanelExpanded || force == true){
            interestPanelExpanded = true;

            var previousExpanded = expandedInterests;
            expandedInterests = {"work": false, "hiring": false, "other": false}
            chosenInterests = {"work": false, "hiring": false, "other": false}

            document.getElementById("backgroundPanel").innerHTML = getWideInterestPanel();
            for(interest in previousExpanded){
                if(previousExpanded[interest] == true){
                    selectInterest(interest)
                }
            }
        }
    }else{
        if(interestPanelExpanded || force == true){
            interestPanelExpanded = false;

            var previousExpanded = expandedInterests;
            expandedInterests = {"work": false, "hiring": false, "other": false}
            chosenInterests = {"work": false, "hiring": false, "other": false}

            document.getElementById("backgroundPanel").innerHTML = getSlimInterestPanel();
            for(interest in previousExpanded){
                if(previousExpanded[interest] == true){
                    selectInterest(interest)
                }
            }
        }
    }
}

var mainInterests = ["work", "hiring", "other"]
var chosenInterests = {"work": false, "hiring": false, "other": false}
var expandedInterests = {"work": false, "hiring": false, "other": false}
var slimExpandedPanelHeights = {"work": 750, "hiring": 938, "other": 0}
var wideExpandedPanelHeights = {"interests": 720, "hiring": 626, "work": 620, "availability": 350}
function selectInterest(interestType){
    if(interestType === "other"){
        return submitFormWithExtraParameters("other");
    }else{
        // Disable other button
        var otherButton = document.getElementById("otherInterestButton");
        if(otherButton != null){
            otherButton.className = "toggleButton"
            otherButton.innerHTML = "Other"
        }

        var button = document.getElementById(interestType + "InterestButton");
        if(button != null && !chosenInterests[interestType]){
            button.className = "toggleButton enabled";
            button.innerHTML += " &#10004;"
        }else if(chosenInterests[interestType] == true && expandedInterests[interestType] == true){
            // If it is already chosen and expanded, shrink the panel
            shrinkExpandedPanel();
            return;
        }else if(expandedInterests[interestType] == false){
            // Current interest is about to be opened, need to check if any others open that need to be shrunk
            for(interest in expandedInterests){
                if(interest != interestType && expandedInterests[interest] == true){
                    // Shrink panels, and then call selectInterest again to open this panel
                    shrinkExpandedPanel(function(){selectInterest(interestType)});
                    return
                }
            }
        }
        chosenInterests[interestType] = true;

        var interestContent = getInterestPicker(interestType)
        if(interestContent != null){
            if(interestPanelExpanded){
                var secondLevel = document.getElementById("secondLevelViewPanel")
                if(secondLevel != null){
                    secondLevel.innerHTML = interestContent["html"];
                    var interestContainer = document.getElementById(interestType + "InterestContainer")
                    if(interestContainer != null){
                        $("#secondLevelViewPanel").animate({marginTop: "0px", height: wideExpandedPanelHeights[interestType] +  "px"}, 300, function(){});
                        $('html,body').animate({scrollTop: wideExpandedPanelHeights["interests"]}, 500);
                    }
                }
            }else{
                var expandPanel = document.getElementById(interestType + "InterestExpandPanel")
                var interestContainer = document.getElementById(interestType + "InterestSlimContainer")
                if(expandPanel != null && interestContainer != null){

                    // Shrink any other open panels
                    for(interest in expandedInterests){
                        if(expandedInterests[interest] == true && interestType != interest){
                            shrinkExpandedPanel();
                        }
                    }

                    expandPanel.innerHTML = interestContent["html"];
                    $("[id='" + interestType + "InterestSlimContainer']").animate({marginTop: "0px", height: slimExpandedPanelHeights[interestType] + "px"}, 300, function(){});  // 250 for interest container, 650 for panel
                }

            }
            expandedInterests[interestType] = true;

            if(interestContent["callbacks"] != null && interestContent["callbacks"].length > 0){
                for(var i=0; i < interestContent["callbacks"].length; i++){
                    interestContent["callbacks"][i]();
                }
            }
        }
    }
}

var selectedAvailableWeekdays = []
function toggleAvailabilityWeekday(weekday){
    var toggleButton = document.getElementById("availability" + weekday + "ToggleButton");
    if(toggleButton != null){
        var weekdayIndex = selectedAvailableWeekdays.indexOf(weekday);
        if(weekdayIndex < 0){
            selectedAvailableWeekdays.push(weekday)
            toggleButton.className = "active";
        }else{
            selectedAvailableWeekdays.splice(weekdayIndex, 1)
            toggleButton.className = "";
        }
    }
}

var weekdays = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"]
var weekdayRepeatOptions = ["For 1 week", "For 2 weeks", "For 1 month", "For 3 months", "For 6 months", "Forever"]
function getDaysOfWeekPicker(){
    var callbacks = [];
    var pickerString = "<div id='availabilityContent' style='height: 200px; position: relative; padding-top: 50px; margin-left: -18px; margin-right: -8px;'>"

    // Add days of week
    pickerString += "<h1 style='margin-bottom: 5px; font-weight: bold; color: rgba(0,0,0,0.8);'> Select which days you are able to work.</h1>"
    pickerString += "<div class='form-style-7' style='padding: 0; margin-bottom: 10px;  margin-top: -5px; font-size: 1.2em; color: rgba(0,0,0,0.5);'> Repeat this schedule every week <div style='display: inline-block; width: 130px; font-size: 0.8em'>" + createSelectForm("", "weekdayRepeatSelect", weekdayRepeatOptions, weekdayRepeatOptions[0]) + "</div></div>"
    pickerString += "<ul class='browseCategoriesList' style='display: inline-block; width: 750px; margin-left: 15px; margin-bottom: 15px;'>"
    for(var i=0; i < weekdays.length; i++){
        pickerString += "<li id='availability" + weekdays[i] + "ToggleButton' style='width: 99px;' onclick='toggleAvailabilityWeekday(" + '"' + weekdays[i] + '");' + "'>" + weekdays[i] + "</li>";
    }
    pickerString += "</ul>"
    pickerString += "<div style='height: 80px; padding-bottom: 5px;'>" + getSecondLevelButtons("work") + "</div>"
    pickerString += "</div>"

    {% if existingAvailability and existingAvailability.daysOfWeek %}
        {% for day in existingAvailability.daysOfWeek %}
            callbacks.push(function(){toggleAvailabilityWeekday("{{day}}")})
        {% endfor %}
    {% endif %}
    return {"html": pickerString, "callbacks": callbacks};
}

function getOpenAvailabilityPicker(){
    var pickerString = "<div id='availabilityContent' style='height: 80px; margin-left: -18px; margin-right: -8px; padding-bottom: 5px; margin-top: 20px;'>" + getSecondLevelButtons("work") + "</div>"
    return {"html": pickerString, "callbacks": []};
}

var calendarMonths = {"available": {"month": null, "year": null},
                      "unavailable": {"month": null, "year": null}}
var selectedDates = []
function getCalendarString(calendarType, month, year){
    if(month == null || month.length === 0){
        month = currentDate.getMonth();
    }
    if(year == null || year.length === 0){
        year = currentDate.getFullYear();
    }

    var calendarData = getCalendarData(month, year)
    var calendarString = '<div class="calendar">'
    // Since calendar is divided by columns, iterate 2d list by columns first
    for(var i=0; i < 7; i++){
        calendarString += '<div class="column"><div class="column-item weekday">' + weekdays[i].substring(0, 2) + '</div>'
        for(var j=0; j < calendarData.length; j++){
            var columnClass = 'column-item'
            if(j === 0 && calendarData[j][i] > 6){
                columnClass += ' prev-month'
            }
            if(j === calendarData.length - 1 && calendarData[j][i] < 7){
                columnClass += ' next-month'
            }
            
            // if current month, add today border and disable days past in the current month
            if(month === currentDate.getMonth() && year === currentDate.getFullYear()){
                if(calendarData[j][i] < currentDate.getDate()){
                    if(columnClass.indexOf('prev-month') < 0 && columnClass.indexOf('next-month') < -1){
                        columnClass += ' prev-month';
                    }
                }else if(calendarData[j][i] === currentDate.getDate()){
                    columnClass += ' today'
                }
            }
            calendarString += '<div class="' + columnClass + '">' + calendarData[j][i] + '</div>'
        }
        calendarString += '</div>'
    }
    calendarString += '</div>'
    calendarMonths[calendarType] = {"month": month, "year": year}
    return calendarString;
}

var calendarTypes = ["available", "unavailable"]
var activeCalendar;
function toggleAvailabilityCalendar(calendarType){
    for(var i=0; i < calendarTypes.length; i++){
        var optionButton = document.getElementById(calendarTypes[i] + "CalendarToggleButton");
        var calendar = document.getElementById(calendarTypes[i] + "Calendar")
        if(optionButton != null){
            if(calendarTypes[i] === calendarType){
                activeCalendar = calendarType + "Calendar";
                optionButton.className = "toggleButton enabled"
                optionButton.innerHTML = "Selected &#10004;";
                enableCalendar(calendarTypes[i])
            }else{
                optionButton.className = "toggleButton";
                optionButton.innerHTML = "Select"
                disableCalendar(calendarTypes[i])
            }
        }
    }
}

function getSpecifyDatesPicker(){
    var callbacks = [];
    callbacks.push(function(){
        loadCalendar("availableCalendar")
        loadCalendar("unavailableCalendar")
        $('#availableCalendar .calendar-header').click();
        $('#unavailableCalendar .calendar-header').click();
        disableCalendar("available")
        disableCalendar("unavailable")
    });
    var pickerString = '<div id="availabilityContent" style=" width: 100%; position: relative; height: 600px; margin-left: -18px; margin-right: -8px; margin-top: 40px;"><h1> Select your dates</h1>';

    // Add left option
    pickerString += '<div style="position: absolute; top: 65px; left: 5px; width: 49%; text-align: left;"><div class="calendar-container" id="availableCalendar">'
    // Add text
    pickerString += '<div style="text-align: center; width: 354px; margin-left: 20px;"><h3 style="margin-bottom: 5px; font-weight: bold; color: rgba(0,0,0,0.8);"> Option 1: Select available days</h3><p>Choose what days you are busy. All unchecked dates will be considered available.</p><div id="availableCalendarToggleButton" class="toggleButton" onclick="toggleAvailabilityCalendar(' + "'available'" + ');" style="height: 30px; margin-right: 3px; padding-top: 10px; margin-bottom: 15px;">Select</div></div>'
    // Add calendar
    pickerString += '<div class="calendar-wrapper" style="padding-left: 20px;"><div class="calendar-base" style=""><div class="calendar-header"><div class="month-wrapper"><div class="header-prev-month" onclick="toggleCalendarMonth(' + "'previous', 'availableCalendar'" + ');"></div><div class="header-current-month">' + months[currentDate.getMonth()] + '</div><div class="header-next-month" onclick="toggleCalendarMonth(' + "'next', 'availableCalendar'" + ');" ></div></div><div class="header-current-day-number">, 23</div><div class="year-wrapper"><div class="header-prev-year" onclick="toggleCalendarYear(' + "'previous', 'availableCalendar'" + ');"></div><div class="header-current-year">' + currentDate.getFullYear() + '</div><div class="header-next-year" onclick="toggleCalendarYear(' + "'next', 'availableCalendar'" + ');"></div></div></div>'
    pickerString += '<div class="small-wrapper">' + getCalendarString("available") + '</div>'
    pickerString += "</div></div></div></div>"


    // Add right option
    pickerString += '<div style="position: absolute; top: 65px; right: 5px; width: 49%; text-align: right;"><div class="calendar-container" id="unavailableCalendar">'
    // Add text
    pickerString += '<div style="text-align: center; width: 354px; margin-left: 20px;"><h3 style="margin-bottom: 5px; font-weight: bold; color: rgba(0,0,0,0.8);"> Option 2: Select unavailable days</h3><p>Choose what days you are busy. All unchecked dates will be considered available.</p><div id="unavailableCalendarToggleButton" class="toggleButton" onclick="toggleAvailabilityCalendar(' + "'unavailable'" + ');" style="height: 30px; margin-right: 3px; padding-top: 10px; margin-bottom: 15px;">Select</div></div>'
    //Add calendar
    pickerString += '<div class="calendar-wrapper" style="padding-right: 18px;"><div class="calendar-base" style="margin-right: 10px;"><div class="calendar-header"><div class="month-wrapper"><div class="header-prev-month" onclick="toggleCalendarMonth(' + "'previous', 'unavailableCalendar'" + ');"></div><div class="header-current-month">' + months[currentDate.getMonth()] + '</div><div class="header-next-month" onclick="toggleCalendarMonth(' + "'next', 'unavailableCalendar'" + ');"></div></div><div class="header-current-day-number">, 23</div><div class="year-wrapper"><div class="header-prev-year" onclick="toggleCalendarYear(' + "'previous', 'unavailableCalendar'" + ');"></div><div class="header-current-year">' + currentDate.getFullYear() + '</div><div class="header-next-year" onclick="toggleCalendarYear(' + "'next', 'unavailableCalendar'" + ');"></div></div></div>'
    pickerString += '<div class="small-wrapper">' + getCalendarString("unavailable") + '</div>'
    pickerString += "</div></div></div></div>"

    pickerString += "<div style='position: absolute; top: 485px; left: 5px; right: -20px;'>" + getSecondLevelButtons("work") + "</div></div>";

    return {"html": pickerString, "callbacks": callbacks}
}

var thirdLevelExpanded = false;
function displayThirdLevel(interestType){
    if(interestPanelExpanded){
        var thirdLevel = document.getElementById("thirdLevelViewPanel")
        if(thirdLevel != null){
            thirdLevel.innerHTML = getWideAvailabilityPanel();
            var interestContainer = document.getElementById(interestType + "InterestContainer")
            if(interestContainer != null){
                thirdLevelExpanded = true;
                var topMargin = -60
                var thirdLevelHeight = wideExpandedPanelHeights["availability"] - topMargin + 10
                $("#nextButtonRow").animate({marginTop: "0px", height: "0px"}, 300, function(){});
                $("#thirdLevelViewPanel").animate({marginTop: topMargin + "px", height: thirdLevelHeight + "px"}, 300, function(){});
                $('html,body').animate({scrollTop: wideExpandedPanelHeights["interests"] + wideExpandedPanelHeights["work"] - 300 + "px"}, 500);
            }
        }
    }
}

function selectAvailabilityOption(option){
    for(var i=0; i < availabilityOptions.length; i++){
        var optionButton = document.getElementById(availabilityOptions[i] + "ToggleButton");
        if(optionButton != null){
            if(availabilityOptions[i] === option){
                optionButton.className = "toggleButton enabled"
                optionButton.innerHTML = "Selected &#10004;";
            }else{
                optionButton.className = "toggleButton";
                optionButton.innerHTML = "Select"
            }
        }
    }

    var contentPanel = document.getElementById("availabilityContentPanel");
    if(contentPanel != null){
            var scrollTop = wideExpandedPanelHeights["interests"] + wideExpandedPanelHeights["work"] + wideExpandedPanelHeights["availability"];
            var content;
            if(option === "daysOfWeek"){
                content= getDaysOfWeekPicker()
                scrollTop -= 390
            }else if(option === "specifyDates"){
                content = getSpecifyDatesPicker();
                scrollTop -= 50
            }else if(option === "openAvailability"){
                content = getOpenAvailabilityPicker();
                scrollTop -= 550
            }
            if(content != null){
                contentPanel.innerHTML = content["html"];
                var contentContainer = document.getElementById("availabilityContent");
                if(contentContainer != null){
                    //var height = $("#thirdLevelViewPanel").height() + contentContainer.offsetHeight - 20 + "px"
                    var height = wideExpandedPanelHeights["availability"] + contentContainer.offsetHeight + 30 + "px"
                    $("#thirdLevelViewPanel").animate({marginTop: $(this).marginTop + "px", height: height}, 300, function(){});
                    $('html,body').animate({scrollTop: scrollTop + "px"}, 500);
                }

                if(content["callbacks"] != null && content["callbacks"].length > 0){
                    for(var i=0; i < content["callbacks"].length; i++){
                        content["callbacks"][i]();
                    }
                }
            }
    }
}

var availabilityOptions = ["openAvailability", "daysOfWeek", "specifyDates"]
function getWideAvailabilityPanel(){
    var panelString = '<div id="availabilityContainer"><div id="wrapper"><div id="three-column" class="container" style="width: 740px; padding-bottom: 5px;"><div class="title" style="margin-bottom: 2em;"><h2>When are you available?</h2><span class="byline">Specify your availability to increase your visibility to recruiters.</span></div>';

    //panelString += "<h2>Pick an option</h2>"

    panelString += "<div class='boxA'><h3 style='margin-bottom: 5px;'>Open Availability</h3><p style='height: 110px; padding-top: 10px;'>Your schedule is open for any position. Recruiters mays contact you for day calls or future positions.</p><div id='openAvailabilityToggleButton' class='toggleButton' onclick='selectAvailabilityOption(" + '"openAvailability"' + ");' style='height: 40px; width: 92%; padding-top: 20px;'>Select</div></div>"

    panelString += "<div class='boxB'><h3 style='margin-bottom: 5px;'>Choose days of week</h3><p style='height: 120px;'>Select days of the week that you are free to work, recruiters will contact you for jobs only on that day of the week.</p><div id='daysOfWeekToggleButton' class='toggleButton' onclick='selectAvailabilityOption(" + '"daysOfWeek"' + ");' style='height: 40px; width: 92%; padding-top: 20px;'>Select</div></div>"

    panelString += "<div class='boxC'><h3 style='margin-bottom: 5px;'>Specify dates</h3><p style='height: 105px; padding-top: 15px;'>Indicate which days you are free or busy in the coming weeks.</p><div id='specifyDatesToggleButton' class='toggleButton' onclick='selectAvailabilityOption(" + '"specifyDates"' + ");' style='height: 40px; width: 92%; padding-top: 20px;'>Select</div></div>"

    panelString += "<div id='availabilityContentPanel' style='width: 100%; overflow: hidden;'></div>"

    panelString += "</div></div></div>";
    return panelString
}

function shrinkExpandedPanel(secondLevelAnimationCallback){
    var interestType;
    for(type in expandedInterests){
        if(expandedInterests[type] == true){
            interestType = type;
            break;
        }
    }

    if(interestType != null){
        if(interestPanelExpanded){
            var secondLevel = document.getElementById("secondLevelViewPanel")
            if(secondLevel != null){
                $("#secondLevelViewPanel").animate({marginTop: "0px", height: "0px"}, 300, function(){
                    secondLevel.innerHTML='';
                    if(secondLevelAnimationCallback != null){
                        secondLevelAnimationCallback();
                    }
                });
                $('html,body').animate({scrollTop: "50px"}, 300);
            }

            if(thirdLevelExpanded){
                var thirdPanel = document.getElementById("thirdLevelViewPanel")
                if(thirdPanel != null){
                    $("#thirdLevelViewPanel").animate({marginTop: "0px", height: "0px"}, 300, function(){});
                    thirdLevelExpanded = false;
                }
            }
        }else{
            var expandPanel = document.getElementById(interestType + "InterestExpandPanel")
            var interestContainer = document.getElementById(interestType + "InterestSlimContainer")
            if(expandPanel != null && interestContainer != null){
                $("[id='" + interestType + "InterestSlimContainer']").animate({marginTop: "0px", height: "250px"}, 300, function(){expandPanel.innerHTML = "";});
            }
        }
        expandedInterests[interestType] = false;
    }
}

function getInterestPicker(interestType){
    if(interestType === "work"){
        if(interestPanelExpanded){
            return getWideWorkInterestPicker();
        }else{
            return getSlimWorkInterestPicker();
        }
    }else if(interestType === "hiring"){
        if(interestPanelExpanded){
            return getWideHiringInterestPicker();
        }else{
            return getSlimHiringInterestPicker();
        }
    }
}

var chosenProfessionList = []
var activeFilter = "acting"
var professionInterests = ["acting", "creative", "preProduction", "postProduction", "onSetProduction", "offSetProduction"];
var professionCategoryTitles = ["Acting &amp; Performing", "Creative Positions", "Production - On set", "Production - Off set", "Pre Production", "Post Production"]
var professionInterestMap = {};
for(var i=0; i < professionInterests.length; i++){
    professionInterestMap[professionInterests[i]] = professionCategoryTitles[i];
}

function getSlimWorkInterestPicker(){
    var callbacks = [];
    var pickerString = '<div id="workInterestContainer"><div style="text-align: center; background: #FFF; padding-top: 10px;">'

    pickerString += "<h3 style='margin-bottom: -15px;'>1. Choose your field</h3><div class='form-style-7' style='width: 74%; margin-bottom: 10px;'>" + createSelectForm("", "professionCategorySelect", professionCategoryTitles, professionCategoryTitles[0]) + "</div>";

    pickerString += "<div style='position: relative; width: 100%; height: 400px;'>"
    pickerString += '<div style="position: absolute; left: 20px; top: 0px;"><h3 style="margin-bottom: 5px;">2. Add professions</h3><div id="professionChoicePanel" class="profession3ColumnsFullPanel" style="margin-left: -1px; width: 270px;"></div></div>';

    pickerString += '<div style="position: absolute; right: 20px; top: 0px;"><h3 style="margin-bottom: 5px;">3. Confirm selections</h3><div id="chosenProfessionChoicePanel" class="profession3ColumnsFullPanel" style="margin-left: -5px; width: 270px;"><table id="chosenProfessionTable" class="professionsSelectList"></table></div></div>'
    pickerString += "</div>"

    // Add callback to filter the professions when select changes
    callbacks.push(function(){
        var professionSelect = document.getElementById("professionCategorySelect");
        if(professionSelect != null){
            $("#professionCategorySelect").on("change", function(){
                for(category in professionInterestMap){
                    if(professionInterestMap[category] === this.value){
                        filterProfessions(category);
                    }
                }
            })
        }
    })

    // Toggle selected professions
    callbacks.push(function(){
        filterProfessions("acting");
        
        var recentlyChosenProfessions = chosenProfessionList;
        chosenProfessionList = [];
        {% if existingProfessions %}
            {% for profession in existingProfessions %}
                addProfessionToSelectedTable("{{profession}}", "{{profession}}_selectedRowID");
            {% endfor %}
        {% endif %}
        // Add any professions that were selected but haven't been saved yet
        for(var i=0; i < recentlyChosenProfessions.length; i++){
            if(chosenProfessionList.indexOf(recentlyChosenProfessions[i]) < 0){
                addProfessionToSelectedTable(recentlyChosenProfessions[i], recentlyChosenProfessions[i] + "_selectedRowID");
            }
        }
    });

    pickerString += "</div></div>"
    return {"html": pickerString, "callbacks": callbacks}
}

function getWideWorkInterestPicker(){
    var callbacks = [];
    var pickerString = '<div id="workInterestContainer"><div id="wrapper"><div id="three-column" class="container" style="width: 740px;"><div class="title" style="margin-bottom: 2em;"><h2>What jobs are you looking for?</h2><span class="byline">Let people know what types of jobs you\'re willing to work</div>'

    // Add square button column
    pickerString += '<div class="boxA"><h3 style="margin-bottom: 15px;">1. Choose your field</h3><table  class="squareButtonTable" id="squareButtonTable" style="margin-left: 5px; margin-top: 18px; margin-right: -5px;"><tr>' + addSquareButtonColumn("Acting &amp; Performing", "filterProfessions('acting');", 'actingSquareButton') + addSquareButtonColumn("Creative Positions", "filterProfessions('creative');", 'creativeSquareButton') + '</tr><tr>' + addSquareButtonColumn("Production - On set", "filterProfessions('onSetProduction');", 'onSetProductionSquareButton') + addSquareButtonColumn("Production - Off set", "filterProfessions('offSetProduction');", 'offSetProductionSquareButton') + '</tr><tr>' + addSquareButtonColumn("Pre Production", "filterProfessions('preProduction');", 'preProductionSquareButton') + addSquareButtonColumn("Post Production", "filterProfessions('postProduction');", 'postProductionSquareButton') + '</tr></table></div>';

    // Add professionList
    pickerString += '<div class="boxB"><h3 style="margin-bottom: 15px;">2. Add professions</h3><div id="professionChoicePanel" class="profession3ColumnsFullPanel" style="margin-left: -1px;"></div></div>'

    pickerString += '<div class="boxC" ><h3 style="margin-bottom: 15px;">3. Confirm selections</h3><div id="chosenProfessionChoicePanel" class="profession3ColumnsFullPanel" style="margin-left: -5px;"><table id="chosenProfessionTable" class="professionsSelectList"></table></div></div>'

    pickerString += "</div></div>";
    //pickerString += "<div style='height: 100px;'>" + getSecondLevelButtons("work") + "</div>"
    pickerString += "<div id='nextButtonRow' style='height: 80px; width: 100%; position: relative; overflow: hidden; margin-top: -10px;'><div style='position: absolute; right: 35px; top: 0px;'><div class='editButton' onclick='displayThirdLevel(" + '"work"' + ");' style='height: 40px; width: 150px; padding-top: 20px; margin-left: 19px;'>Next</div>" 

    pickerString += "</div>"

    callbacks.push(function(){
        filterProfessions("acting");
        
        var recentlyChosenProfessions = chosenProfessionList;
        chosenProfessionList = [];
        {% if existingProfessions %}
            {% for profession in existingProfessions %}
                addProfessionToSelectedTable("{{profession}}", "{{profession}}_selectedRowID");
            {% endfor %}
        {% endif %}
        // Add any professions that were selected but haven't been saved yet
        for(var i=0; i < recentlyChosenProfessions.length; i++){
            if(chosenProfessionList.indexOf(recentlyChosenProfessions[i]) < 0){
                addProfessionToSelectedTable(recentlyChosenProfessions[i], recentlyChosenProfessions[i] + "_selectedRowID");
            }
        }
    });
    return {"html": pickerString, "callbacks": callbacks}
}

function submitSlimForm(interestType){
    // Determines the interest type to submit if passed interest type is null or undefined
    if(interestType === "undefined"){
        interestType = null;
    }
    if(interestType == null){
        for(type in expandedInterests){
            if(expandedInterests[type] == true){
                interestType = type;
                break;
            }
        }
        if(interestType == null){
            for(type in chosenInterests){
                if(chosenInterests[type] == true){
                    interestType = type;
                    break;
                }
            }
        }
    }
    // Special case, python expects hire instead of hiring
    if(interestType === "hiring"){
        interestType = "hire";
    }
    submitFormWithExtraParameters(interestType)
}

function getSecondLevelButtons(interestType){
    if(interestPanelExpanded){
        return '<div style="width: 100%; height: 60px;"><div id="backButton" onclick="shrinkExpandedPanel();" class="editButton" style="height: 40px; width: 45%; padding-top: 20px; float: left; margin-left: 19px;" onclick="">Back</div><div id="continueButton" class="editButton" style="height: 40px; width: 45%; padding-top: 20px; float: right; margin-right: 16px;" onclick="submitFormWithExtraParameters(' + "'" + interestType + "'" + ');">Continue</div></div>';
    }else{
        return '<div style="width: 100%; height: 60px;"><div id="backButton" onclick="cancelPage();" class="editButton" style="height: 40px; width: 260px; padding-top: 20px; float: left; margin-left: 20px;" onclick="">Back</div><div id="continueButton" class="editButton" style="height: 40px; width: 260px; padding-top: 20px; float: right; margin-right: 20px;" onclick="submitSlimForm(' + "'" + interestType + "'" + ');">Continue</div></div>';
    }
}

function getSlimHiringInterestPicker(){
    var callbacks = [];
    {% if existingHiringInterests %}
        {% for interest in existingHiringInterests %}
            callbacks.push(function(){toggleHireType("{{interest.subInterest}}")});
        {% endfor %}
    {% endif %}

    var pickerString = '<div id="hiringInterestContainer">'

    // Add top option
    pickerString += "<div style='height: 200px; width: 100%; border-top: 1px solid rgba(0,0,0,0.3); background: rgba(255,255,255,0.7); position: relative;'><div style='position: absolute; left: 50px; top: 60px;'><img src='{{images.icons.hiring}}' style='max-height: 100px; max-width: 100px;' /></div><div style='position: absolute; right: 20px; left: 200px; top: 20px;'><h2 style='margin-bottom: 10px;'>Hiring</h2><p>Are you gearing up for production and looking for crew members? Find available professionals seeking work for any field from pre to post production.</p>" + '<div id="hiringToggleButton" class="toggleButton" style="height: 30px; padding-top: 10px; margin: -5px auto 0 auto; width: 60%; left: 0; right: 0; " onclick="toggleHireType(' + "'hiring'" +  ');">Select</div></div></div>';

    pickerString += "<div style='height: 200px; margin-top: 30px; border-top: 1px solid rgba(0,0,0,0.3); width: 100%; background: rgba(255,255,255,0.7); position: relative;'><div style='position: absolute; left: 50px; top: 60px;'><img src='{{images.icons.casting}}' style='max-height: 100px; max-width: 100px;' /></div><div style='position: absolute; right: 20px; left: 200px; top: 20px;'><h2 style='margin-bottom: 10px;'>Casting</h2><p>Are you casting roles for an upcoming project? Search our Actor database to find available actors in your area.</p>" + '<div id="castingToggleButton" class="toggleButton" style="height: 30px; padding-top: 10px; margin: -5px auto 0 auto; width: 60%; left: 0; right: 0; " onclick="toggleHireType(' + "'casting'" +  ');">Select</div></div></div>';

    pickerString += "<div style='height: 255px; width: 100%; border-top: 1px solid rgba(0,0,0,0.3); border-bottom: 1px solid rgba(0,0,0,0.3); margin-bottom: 20px; background: rgba(255,255,255,0.7); position: relative;'><div style='position: absolute; left: 50px; top: 60px;'><img src='{{images.icons.collaborating}}' style='max-height: 100px; max-width: 100px;' /></div><div style='position: absolute; right: 20px; left: 200px; top: 20px;'><h2 style='margin-bottom: 10px;'>Collaborating</h2><p>Are looking for filmmakers to collaborate on a project with? Whether you are looking for a partner, or just someone to bounce ideas off of, find others looking to collaborate.</p>" + '<div id="collaboratingToggleButton" class="toggleButton" style="height: 30px; padding-top: 10px; margin: -5px auto 0 auto; width: 60%; left: 0; right: 0; " onclick="toggleHireType(' + "'collaborating'" +  ');">Select</div></div></div>';

    //pickerString += getSecondLevelButtons("hire")

    pickerString += "</div>";
    return {"html": pickerString, "callbacks": callbacks}
}

function getWideHiringInterestPicker(){
    var callbacks = []
    var pickerString = '<div id="hiringInterestContainer"><div id="wrapper"><div id="three-column" class="container" style="width: 740px;"><div class="title"><h2>Who are you looking for?</h2><span class="byline">Specify your hiring needs</span></div>'

    var buttonTexts = {"left": "Hiring", "center": "Casting", "right": "Collaborating"}
    {% if existingHiringInterests %}
        {% for interest in existingHiringInterests %}
            callbacks.push(function(){toggleHireType("{{interest.subInterest}}")});
        {% endfor %}
    {% endif %}

    // Add left panel
    pickerString += '<div class="boxA"><h2>Hiring</h2><div style="height: 110px;"><img src="{{images.icons.hiring}}" style="max-height: 55px; max-width: 60px; margin-top: 25px;" /></div><p style="height: 160px; padding-top: 8px;">Are you gearing up for production and looking for crew members? Find available professionals seeking work for any field from pre to post production.</p><div id="hiringToggleButton" class="toggleButton" style="height: 40px; width: 92%; padding-top: 20px; margin: 20px 5px 10px 5px;" onclick="toggleHireType(' + "'hiring'" + ');">Enable</div></div>'

    // Add center panel
    pickerString += '<div class="boxB"><h2>Casting</h2><div style="height: 110px;"><img src="{{images.icons.casting}}" style="max-height: 60px; max-width: 60px; margin-top: 25px;" /></div><p style="height: 153px; padding-top: 15px;">Are you casting roles for an upcoming project? Search our Actor database to find available actors in your area.</p><div id="castingToggleButton" class="toggleButton" style="height: 40px; width: 92%; padding-top: 20px; margin: 20px 5px 10px 5px;" onclick="toggleHireType(' + "'casting'" + ');">Enable</div></div>'

    // Add right panel
    pickerString += '<div class="boxC"><h2>Collaborating</h2><div style="height: 110px;"><img src="{{images.icons.collaborating}}" style="max-height: 60px; max-width: 60px; margin-top: 20px;" /></div><p>Are looking for filmmakers to collaborate on a project with? Whether you are looking for a partner, or just someone to bounce ideas off of, find others looking to collaborate.</p><div id="collaboratingToggleButton" class="toggleButton" style="height: 40px; width: 92%; padding-top: 20px; margin: 20px 5px 10px 5px;" onclick="toggleHireType(' + "'collaborating'" + ');">Enable</div></div>'

    pickerString += "</div>";
    pickerString += getSecondLevelButtons("hire");

    pickerString += "</div>"
    return {"html": pickerString, "callbacks": callbacks}
}

var hireTypes = ["hiring", "casting", "collaborating"];
var chosenHireTypes = {"hiring": false, "casting": false, "collaborating": false};

function toggleHireType(hireType){
    var button = document.getElementById(hireType + "ToggleButton");
    if(button != null){
        if(chosenHireTypes[hireType] == true){
            button.innerHTML = "Disabled"
            button.className = "toggleButton"
            chosenHireTypes[hireType] = false;
        }else{
            button.innerHTML = "Enabled  &#10004;"
            button.className = "toggleButton enabled"
            chosenHireTypes[hireType] = true;
        }
    }
}

function addSquareButtonColumn(label, onclickString, idName){
    // Writes a table cell containing a square button
    var squareButtonString = '<td id="' + idName + '" onclick="' + onclickString + '" >' + label + '</td>';
    return squareButtonString
}

function toggleProfession(profession){
     // If profession is in chosenProfessionList, remove from the list, otherwise, add it (and do all relevant front end changes)
    var professionCheckbox = document.getElementById(profession + "_checkbox");
    var professionRowID = profession + "_selectedRowID";
    if(chosenProfessionList.indexOf(profession) >= 0){
        if(professionCheckbox != null){
            professionCheckbox.checked = false;
        }
        removeProfession(profession, professionRowID)
    }else{
        if(professionCheckbox != null){
            professionCheckbox.checked = "checked";
        }
        addProfessionToSelectedTable(profession, professionRowID)
    }
}

function addProfessionToSelectedTable(profession, professionRowID){
    // Adds a profession to the chosenProfessionTable displayed on the right
    var table = document.getElementById("chosenProfessionTable");
    if(table != null && chosenProfessionList.indexOf(profession) < 0){
        chosenProfessionList.push(profession);
        var newProfessionRow = table.insertRow(-1);
        newProfessionRow.id = professionRowID;
        var newProfessionCell = newProfessionRow.insertCell(0);
        newProfessionCell.className = "professionsSelectColumn"
        newProfessionCell.onclick = '"toggleProfession(' + "'" + profession + "'" + ');"';
        newProfessionCell.innerHTML = "<a> " + profession + "</a><a onclick='toggleProfession(" + '"' + profession + '"' + ");' style='float:right; margin: 0px 5px 0px 0px;' /> X</a>";
        $("[id='" + professionRowID + "']").hover(function(){
                // On row hover, set the a text to white
                setChildColor(this.id, "a", "#fff");
            },
            function(){
                // On row unhover, set the a text back to black
                setChildColor(this.id, "a", "#000");
        });
    }
}

function removeProfession(profession, professionRowID){
    // Removes a profession from the chosenProfessionList, and fron the selected list displayed in the chosenProfessionTable
    var professionIndex = chosenProfessionList.indexOf(profession);
    if(professionIndex >= 0){
        chosenProfessionList.splice(professionIndex, 1);        // Second argument is # of elements to cutout
        var professionRow = document.getElementById(professionRowID);
        professionRow.parentNode.removeChild(professionRow);
    }
}

function setChildColor(parentID, tag, color){
    // Sets all children of parentID of element type tag to color
    var parent = document.getElementById(parentID);
    if(parent != null){
        var children = parent.getElementsByTagName(tag);
        for(var i=0; i < children.length; i++){
            children[i].style.color = color;
        }
    }
}

function filterProfessions(key){
    // When square button pressed, filter the possible professions displayed. Key is the field of the profession (acting, creative, etc)
    for(var i=0; i < professionInterests.length; i++){
        var interestDiv = document.getElementById(professionInterests[i] + "SquareButton");
        if(interestDiv != null){
            interestDiv.className = "squareButton";
        }
    }

    var professionChoiceDiv = document.getElementById("professionChoicePanel")
    if(professionChoiceDiv != null){
        {% if professions %}
            // Add possible profession choices to panel
            var professionListString = "<table class='professionsSelectList'>";
            var professions = {{ professions|safe }};
            var professionRows = [];
            var professionCols = [];
            for(var i=0; i < professions[key].length; i++){
                var checkedValue = "";
                if(chosenProfessionList.indexOf(professions[key][i]) >= 0){
                    checkedValue = "checked";
                }
                var rowID = professions[key][i] + "_rowID";     //put the hover on the row element
                professionRows.push(rowID);
                var colID = professions[key][i] + "_colID";     //change the 
                professionListString += "<tr id='" + rowID + "'><td class='professionsSelectColumn' id='" + colID + "'onclick='toggleProfession(" + '"' + professions[key][i] + '");' + "'><a> " + professions[key][i] + "</a><input type='checkbox' id='" + professions[key][i] + "_checkbox' " + checkedValue + " style='float:right; margin: 8px 5px 0px 0px;' /></td></tr>";
            }
            professionListString += "</table>";
            document.getElementById("professionChoicePanel").innerHTML = professionListString;

            // On filter, set all square button text to white
            setChildColor("squareButtonTable", "h1", "#fff");

            // Add active class to square buttons
            var buttonDivId = key + "SquareButton";
            var professionFilterButtonDiv = document.getElementById(buttonDivId);
            if(professionFilterButtonDiv != null){
                professionFilterButtonDiv.className = "squareButton active";

                // Set the active squre button text to black
                setChildColor(buttonDivId, "h1", "#000");
            }

            // Add hover to each of the rows
            for(var i=0; i < professionRows.length; i++){
                $("[id='" + professionRows[i] + "']").hover(function(){
                    setChildColor(this.id, "a", "#fff");
                },
                function(){
                    setChildColor(this.id, "a", "#000");
                });
            }
        {% endif %}
    }
}

</script>
    <div id='backgroundPanel' class='backgroundPanel' style='min-height: 100%;'>
        <script>
            if($(window).width() > interestPanelWidthThreshold){
                interestPanelExpanded = true;
                document.write(getWideInterestPanel());
            }else{
                interestPanelExpanded = false;
                document.write(getSlimInterestPanel());
            }
        </script>
    </div>
    <script>
        $(window).resize(function (){
            resizeInterestPanel();
        });
    </script>
{% endif %}
{% endblock %}