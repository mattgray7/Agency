{% extends "base.html" %}

{% block content %}
	{% if errors %}
		<ul>
			{% for error in errors %}
				<li>{{ error }}</li>
			{% endfor %}
		</ul>
	{% endif %}

	{% if next == possibleDestinations.interests %}
		<script>
		var chosenProfessionList = []
		var activeFilter = "acting"
		var professionInterests = ["acting", "creative", "preProduction", "postProduction", "onSetProduction", "offSetProduction"];

		function addSquareButtonColumn(label, onclickString, idName){
			// Writes a table cell containing a square button
			var squareButtonString = '<td id="' + idName + '_cell" onclick="' + onclickString + '" ><div class="squareButton" id="' + idName + '"><h1>' + label + '</h1></div></td>';
			document.write(squareButtonString);
			var buttonCell = document.getElementById(idName + "_cell");
			var buttonDiv = document.getElementById(idName);

			$("[id='" + idName + "_cell']").hover(function(){
				setChildColor(this.id, "h1", "#000");
			},
			function(){
				if(buttonDiv.className === "squareButtonActive"){
					setChildColor(this.id, "h1", "#000");
				}else{
					setChildColor(this.id, "h1", "#fff");
				}
			});
		}

		function submitForm(){
			// Submits the submit profession button
			var formButtonDiv = document.getElementById("continueButton");
			var extraInputs = []
            for(var i=0; i < chosenProfessionList.length; i++){
            	var profession = chosenProfessionList[i];
            	extraInputs.push({key: "profession." + profession, value: true})
            }
			var form = createPageRedirectForm("{{next}}", "{{next}}", "{{destination}}", "{{currentPageURL}}", extraInputs, null);
			form.submit();
		}

		function toggleProfession(profession){
			// If profession is in chosenProfessionList, remove from the list, otherwise, add it (and do all relevant front end changes)
			var professionCheckbox = document.getElementById(profession + "_checkbox");
			var professionRowID = profession + "_selectedRowID";
			if(chosenProfessionList.indexOf(profession) >= 0){
				if(professionCheckbox != null){
					professionCheckbox.checked = false;
				}
				removeProfession(profession, professionRowID)
			}else{
				if(professionCheckbox != null){
					professionCheckbox.checked = "checked";
				}
				addProfession(profession, professionRowID)
			}
		}

		function addProfession(profession, professionRowID){
			// Adds a profession to the chosenProfessionTable displayed on the right
			var table = document.getElementById("chosenProfessionTable");
			if(table != null && chosenProfessionList.indexOf(profession) < 0){
				chosenProfessionList.push(profession);
				var newProfessionRow = table.insertRow(-1);
				newProfessionRow.id = professionRowID;
				var newProfessionCell = newProfessionRow.insertCell(0);
				newProfessionCell.className = "professionsSelectColumn"
				newProfessionCell.onclick = '"toggleProfession(' + "'" + profession + "'" + ');"';
				newProfessionCell.innerHTML = "<a> " + profession + "</a><a onclick='toggleProfession(" + '"' + profession + '"' + ");' style='float:right; margin: 0px 5px 0px 0px;' /> X</a>";
				$("[id='" + professionRowID + "']").hover(function(){
						// On row hover, set the a text to white
						setChildColor(this.id, "a", "#fff");
					},
					function(){
						// On row unhover, set the a text back to black
						setChildColor(this.id, "a", "#000");
				});
			}
		}

		function removeProfession(profession, professionRowID){
			// Removes a profession from the chosenProfessionList, and fron the selected list displayed in the chosenProfessionTable
			var professionIndex = chosenProfessionList.indexOf(profession);
			if(professionIndex >= 0){
				chosenProfessionList.splice(professionIndex, 1);		// Second argument is # of elements to cutout
				var professionRow = document.getElementById(professionRowID);
    			professionRow.parentNode.removeChild(professionRow);
			}
		}

		function setChildColor(parentID, tag, color){
			// Sets all children of parentID of element type tag to color
			var parent = document.getElementById(parentID);
			var children = parent.getElementsByTagName(tag);
			for(var i=0; i < children.length; i++){
				children[i].style.color = color;
			}
		}

		function filterProfessions(key){
			// When square button pressed, filter the possible professions displayed. Key is the field of the profession (acting, creative, etc)
			for(var i=0; i < professionInterests.length; i++){
				var interestDiv = document.getElementById(professionInterests[i] + "SquareButton");
				if(interestDiv != null){
					interestDiv.className = "squareButton";
				}
			}

			var professionChoiceDiv = document.getElementById("professionChoicePanel")
			if(professionChoiceDiv != null){
				{% if professions %}
					// Add possible profession choices to panel
					var professionListString = "<table class='professionsSelectList'>";
					var professions = {{ professions|safe }};
					var professionRows = [];
					var professionCols = [];
					for(var i=0; i < professions[key].length; i++){
						var checkedValue = "";
						if(chosenProfessionList.indexOf(professions[key][i]) >= 0){
							checkedValue = "checked";
						}
						var rowID = professions[key][i] + "_rowID";		//put the hover on the row element
						professionRows.push(rowID);
						var colID = professions[key][i] + "_colID";		//change the 
						professionListString += "<tr id='" + rowID + "'><td class='professionsSelectColumn' id='" + colID + "'onclick='toggleProfession(" + '"' + professions[key][i] + '");' + "'><a> " + professions[key][i] + "</a><input type='checkbox' id='" + professions[key][i] + "_checkbox' " + checkedValue + " style='float:right; margin: 8px 5px 0px 0px;' /></td></tr>";
					}
					professionListString += "</table>";
					document.getElementById("professionChoicePanel").innerHTML = professionListString;

					// On filter, set all square button text to white
					setChildColor("squareButtonTable", "h1", "#fff");

					// Add active class to square buttons
					var buttonDivId = key + "SquareButton";
					var professionFilterButtonDiv = document.getElementById(buttonDivId);
					if(professionFilterButtonDiv != null){
						professionFilterButtonDiv.className = "squareButtonActive";

						// Set the active squre button text to black
						setChildColor(buttonDivId, "h1", "#000");
					}

					// Add hover to each of the rows
					for(var i=0; i < professionRows.length; i++){
						$("[id='" + professionRows[i] + "']").hover(function(){
							setChildColor(this.id, "a", "#fff");
						},
						function(){
							setChildColor(this.id, "a", "#000");
						});
					}
				{% endif %}
			}
		}
		</script>

		<div id="workInterestDiv" style="display:none;">
			<h2>What kind of jobs are you looking for?</h2>
			<div id="wrapper">
				<table id="workInterestPanel">
					<tr>
						<td width="34%"><center><font color="black">1. Choose your field</font></center></td>
						<td width="33%"><center><font color="black">2. Add your professions</font></center></td>
						<td width="33%"><center><font color="black">3. Confirm your selections</font></center></td>
					</tr>
					<tr>
						<td width="34%">
							<table class="squareButtonTable" id="squareButtonTable">
								<thead>
								</thead>
								<tr>
									<script>
									addSquareButtonColumn("Acting &amp; Performing", "filterProfessions('acting');", 'actingSquareButton');
									addSquareButtonColumn("Creative Positions", "filterProfessions('creative');", 'creativeSquareButton');
									</script>
								</tr>
								<tr>
									<script>
									addSquareButtonColumn("Production - On set", "filterProfessions('onSetProduction');", 'onSetProductionSquareButton');
									addSquareButtonColumn("Production - Off set", "filterProfessions('offSetProduction');", 'offSetProductionSquareButton');
									</script>
								</tr>
								<tr>
									<script>
									addSquareButtonColumn("Pre Production", "filterProfessions('preProduction');", 'preProductionSquareButton');
									addSquareButtonColumn("Post Production", "filterProfessions('postProduction');", 'postProductionSquareButton');
									</script>
								</tr>
							</table>
						</td>
						<td width="33%">
							<div id="professionChoicePanel" class="profession3ColumnsFullPanel">
								<!--<div id="professionChoiceSubPanel" class="profession3ColumnsFullPanel_1"></div>-->
							</div>
						</td>
						<td width="33%">
							<div id="chosenProfessionChoicePanel" class="profession3ColumnsFullPanel">
								<!--<div id="chosenProfessionChoiceSubPanel" class="profession3ColumnsFullPanel_1">-->
									<table id="chosenProfessionTable" class="professionsSelectList">
									</table>
								
							</div>
						</td>

					</tr>
					<tr>
						<td colspan="3">
							<center>
								<div id="cancelButton" class="wrapperButton"><div id="cancelButtonLabel"></div></div>
								<div id="continueButton" class="wrapperButton" onclick="submitForm()"><div id="continueButtonLabel">Continue</div>
							</center>
						</td>
					</tr>
				</table>
			</div>
		</div>

		<script>
		var hireTypes = ["hireProject", "hirePermanent", "casting", "collaborating"];
		var chosenHireTypes = [];

		function toggleHireType(hireType){
			if(chosenHireTypes.indexOf(hireType) < 0){
				activateHireType(hireType);
			}else{
				console.log("deactivating hireType")
				deactivateHireType(hireType);
			}
		}

		function activateHireType(hireType){
			if(chosenHireTypes.indexOf(hireType) < 0){
				chosenHireTypes.push(hireType);
			}
			var checkbox = document.getElementById(hireType + "Checkbox");
			if(checkbox != null){
				checkbox.checked = "checked"
			}
			var table = document.getElementById(hireType + "Table")
			if(table != null){
				table.className = "hireTableColumnActive";
				var children = table.getElementsByTagName("td");
				for(var i=0; i < children.length; i++){
					children[i].style.background = "#232323";
					children[i].style.color = "#FFF";
					children[i].cursor = "pointer";
				}
			}
		}

		function deactivateHireType(hireType){
			var hireTypeIndex = chosenHireTypes.indexOf(hireType);
			if(hireTypeIndex >= 0){
				chosenHireTypes.splice(hireTypeIndex, 1);		// Second argument is # of elements to cutout
			}
			var checkbox = document.getElementById(hireType + "Checkbox");
			if(checkbox != null){
				checkbox.checked = false;
			}
			var table = document.getElementById(hireType + "Table")
			if(table != null){
				table.className = "hireTableColumn";
				var children = table.getElementsByTagName("td");
				for(var i=0; i < children.length; i++){
					children[i].style.background = "#4f4f4f";
					children[i].style.color = "#FFF";
					children[i].cursor = "pointer";
				}
			}
		}

		function addPanelHover(panelType){
			var panelId = panelType + "PanelCell";
			var tableId = panelType + "Table";
			var table = document.getElementById(tableId)
			var tableIsActive = (table != null && table.className.endsWith("Active"));
			console.log(tableIsActive)
			$("[id='" + panelId + "']").hover(function(){
				if(table == null || !table.className.endsWith("Active")){
					this.style.background = "#4f4f4f";
					var children = this.getElementsByTagName("td");
					for(var i=0; i < children.length; i++){
						children[i].style.background = "#4f4f4f";
						children[i].style.color = "#FFF";
						children[i].cursor = "pointer";
					}
				}else{
					console.log("hover is active")
				}
			},
			function(){
				if(table != null && table.className.endsWith("Active")){
					setChildColor(this.id, "h1", "#FFF");
					this.style.background = "#232323";
					var children = this.getElementsByTagName("td");
					for(var i=0; i < children.length; i++){
						children[i].style.background = "#232323";
						children[i].style.color = "#FFF";
					}
				}else{
					setChildColor(this.id, "h1", "#000");
					this.style.background = "#efefef";
					var children = this.getElementsByTagName("td");
					for(var i=0; i < children.length; i++){
						children[i].style.background = "#efefef";
						children[i].style.color = "#000";
					}
				}
			});
		}

		$(document).ready(function(){
			for(var i=0; i < hireTypes.length; i++){
				addPanelHover(hireTypes[i]);
			};
		});

		</script>

		<div id="hireInterestDiv" style="display:none;">
			<div id="wrapper" width="700px;">
				<div id="four-column" class="container">
					<div class="title">
						<h2>What are your interests?</h2>
						<span class="byline">Specify your hiring needs</span>
					</div>
					<table class="hireOptionTable">
						<tr>
							<td id="hireProjectPanelCell" onclick="toggleHireType('hireProject');">
								<table id="hireProjectTable" class="hireTableColumn">
									<tr style="height:30px; overflow:hidden;">
										<td class="hireTableColumnElement">
											<input type="checkbox" name="hireProject" id="hireProjectCheckbox" class="largeCheckbox" style="float:left"/>
										</td>
									</tr>
									<tr>
										<td class="box1 hireTableColumnElement">
											<h2>Hire position for a project</h2>
											<span class="fa fa-cloud-download"></span>
										</td>
									</tr>
									<tr>
										<td class="box1 hireTableColumnElement">
											<h4>Hire position for a project description</h4>
										</td>
									</tr>
									<tr>
										<td class="box1 hireTableColumnElement">
											<a onclick="selectHireProject()" class="button button-alt button-bottom">Hiring - Project</a>
										</td>
									</tr>
								</table>
							</td>

							<td id="hirePermanentPanelCell" onclick="toggleHireType('hirePermanent');">
								<table id="hirePermanentTable" class="hireTableColumn">
									<tr style="height:30px; overflow:hidden;">
										<td class="hireTableColumnElement">
											<input type="checkbox" name="hirePermanent" id="hirePermanentCheckbox" class="largeCheckbox" style="float:left" />
										</td>
									</tr>
									<tr>
										<td class="box2 hireTableColumnElement">
											<h2>Hire for permanent position</h2>
											<span class="fa fa-cloud-download"></span>
										</td>
									</tr>
									<tr>
										<td class="box2 hireTableColumnElement">
											<h4>Hire for permanent or contract position description</h4>
										</td>
									</tr>
									<tr>
										<td class="box2 hireTableColumnElement">
											<a onclick="selectHirePermanent()" class="button button-alt button-bottom">Hiring - Permanent</a>
										</td>
									</tr>
								</table>
							</td>

							<td id="castingPanelCell" onclick="toggleHireType('casting');">
								<table id="castingTable" class="hireTableColumn">
									<tr style="height:15px; overflow:hidden;">
										<td class="hireTableColumnElement">
											<input type="checkbox" name="casting" id="castingCheckbox" class="largeCheckbox" style="float:left"/>
										</td>
									</tr>
									<tr>
										<td class="box3 hireTableColumnElement">
											<h2>Cast a role for a project</h2>
											<span class="fa fa-cloud-download"></span>
										</td>
									</tr>
									<tr>
										<td class="box3 hireTableColumnElement">
											<h4>Casting post description</h4>
										</td>
									</tr>
									<tr>
										<td class="box3 hireTableColumnElement">
											<a onclick="selectCasting()" class="button button-alt button-bottom">Casting</a>
										</td>
									</tr>
								</table>
							</td>

							<td id="collaboratingPanelCell" onclick="toggleHireType('collaborating');">
								<table id="collaboratingTable" class="hireTableColumn">
									<tr style="height:15px; overflow:hidden;">
										<td class="hireTableColumnElement">
											<input type="checkbox" name="collaborating" id="collaboratingCheckbox" class="largeCheckbox" style="float:left"/>
										</td>
									</tr>
									<tr>
										<td class="box4 hireTableColumnElement">
											<h2>Looking for collaborators</h2>
											<span class="fa fa-cloud-download"></span>
										</td>
									</tr>
									<tr>
										<td class="box4 hireTableColumnElement">
											<h4>Looking for collaborators description</h4>
										</td>
									</tr>
									<tr>
										<td class="box4 hireTableColumnElement">
											<a onclick="selectCollaborating()" class="button button-alt button-bottom">Collaborating</a>
										</td>
									</tr>
								</table>
							</td>
						</tr>
					</table>
				</div>
			</div>
		</div>

		<script>

		function selectWorkInterest(){
			document.getElementById("interestsDiv").innerHTML = "";
			document.getElementById("workInterestDiv").style.display = "block";
			{% if existingProfessions %}
				{% for profession in existingProfessions %}
					toggleProfession("{{profession.professionName}}")
				{% endfor %}
			{% endif %}
			filterProfessions("acting");
		}

		function selectHireInterest(){
			document.getElementById("interestsDiv").innerHTML = "";
			document.getElementById("hireInterestDiv").style.display = "block";
			{% if existingHireInterests %}
				{% for hireInterest in existingHireInterests %}
					toggleHireInterest("{{hireInterest.subInterest}}")
				{% endfor %}
			{% endif %}
		}

		function selectOtherInterest(){
			console.log("other selected");
		}

		</script>
		<div id="interestsDiv">
			<div id="wrapper" width="700px;">
				<div id="three-column" class="container">
					<div class="title">
						<h2>What are your interests?</h2>
						<span class="byline">Specify what you are looking for.</span>
					</div>
					<table>
						<tr>
							<td class="boxA">
								<h2>Job Seeking</h2>
								<span class="fa fa-cloud-download"></span>
							</td>
							<td class="boxB">
								<h2>Casting and Hiring</h2>
								<span class="fa fa-cogs"></span>
							</td>
							<td class="boxC">
								<h2> Explore </h2>
								<span class="fa fa-wrench"></span>
							</td>
						</tr>
						<tr>
							<td class="boxA">
								<p>Look for a job in the Vancouver film industry in anything from acting to set work to post production. Your profile will be public to casting agents and those looking to hire.</p>
							</td>
							<td class="boxB">
								<p>Create casting posts and job posts for both permanent and project-specific positions. You can also post in search of collaborators for a new project.</p><br>
							</td>
							<td class="boxC">
								<p> Explore the film industry around you. Check out local events, view projects that are currently being shot in Vancouver, </p><br><br><br>
							</td>
						</tr>
						<tr>
							<td class="boxA">
								<br>
								<a onclick="selectWorkInterest()" class="button button-alt button-bottom">Looking for a job</a>
							</td>
							<td class="boxB">
								<a onclick="selectHireInterest()" class="button button-alt button-bottom">Looking to hire, collaborate, or cast a role</a>
							</td>
							<td class="boxC">
								<br>
								<a onclick="selectOtherInterest()" class="button button-alt button-bottom">Other</a>
							</td>
						</tr>
					</table>
				</div>
			</div>
		</div>
	{% endif %}

	<!--{% if userAccount %}
		{% if userAccount.profilePicture %}
			<div id="profilePicture">
				<img src="{{ userAccount.profilePicture.url }}" height="150px" width="175px"/>
			</div>
		{% endif %}
	{% endif %}

	{% if next != possibleDestinations.interests %}
		{% if currentPageURL == "/account/edit/picture/" %}
			<form method='post' action="{{ currentPageURL }}" enctype="multipart/form-data">
		{% else %}
			<form method='post' action="{{ currentPageURL }}">
		{% endif %}
			{% csrf_token %}
			{{ form.as_p }}
			<input type="submit" value="{{ nextButtonString }}" />
		</form>
	{% endif %}-->

{% endblock %}